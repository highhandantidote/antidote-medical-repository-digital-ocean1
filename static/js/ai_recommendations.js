document.addEventListener("DOMContentLoaded",function(){let o=document.getElementById("ai-recommendation-form");if(o){var e=document.getElementById("upload-image-btn");let n=document.getElementById("image-input"),t=document.getElementById("image-preview"),r=document.getElementById("image-preview-container");var a=document.getElementById("remove-image-btn"),i=document.getElementById("record-audio-btn");e&&n&&(e.addEventListener("click",function(){n.click()}),n.addEventListener("change",function(){var e;this.files&&this.files[0]&&((e=new FileReader).onload=function(e){t.src=e.target.result,r.classList.remove("d-none")},e.readAsDataURL(this.files[0]))})),a&&a.addEventListener("click",function(){n.value="",r.classList.add("d-none")}),i&&i.addEventListener("click",function(){var e=document.querySelector('meta[name="recommendation-form-url"]').getAttribute("content");window.location.href=e}),o.addEventListener("submit",function(e){e.preventDefault();var e=new FormData,t=document.getElementById("query_text").value;if(t&&e.append("query_text",t),n&&n.files&&n.files[0]&&e.append("image",n.files[0]),t||n&&n.files&&n.files[0]){let n=o.querySelector('button[type="submit"]'),r=n.innerHTML;n.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...',n.disabled=!0;var t=document.querySelector('meta[name="analyze-query-url"]').getAttribute("content");fetch(t,{method:"POST",body:e}).then(e=>e.json()).then(e=>{var t;n.innerHTML=r,n.disabled=!1,e.success?(localStorage.setItem("ai_recommendation_results",JSON.stringify(e)),t=document.querySelector('meta[name="recommendation-results-url"]').getAttribute("content"),window.location.href=t):alert("Error: "+(e.message||"Unknown error"))}).catch(e=>{console.error("Error:",e),n.innerHTML=r,n.disabled=!1,alert("An error occurred. Please try again or use the full form.")})}else t=document.querySelector('meta[name="recommendation-form-url"]').getAttribute("content"),window.location.href=t})}});