function createReply(e,t,r,n=null){console.log("Creating reply:",{threadId:e,content:t,isAnonymous:r,parentReplyId:n});t={content:t,is_anonymous:r};return n&&(t.parent_reply_id=n),fetch(`/api/community/${e}/replies`,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)}).then(t=>(console.log("Response status:",t.status,"OK:",t.ok),console.log("Response headers:",t.headers),t.ok?t.json():t.text().then(e=>{throw console.error("Response body:",e),new Error(`HTTP ${t.status}: ${e.substring(0,100)}...`)}))).then(e=>{if(e.success)return console.log("Reply success:",e.message),e;throw new Error(e.message||"Reply failed")}).catch(e=>{throw console.error("Reply error:",e),alert("Error posting reply: "+e.message),e})}document.addEventListener("DOMContentLoaded",function(){let o=document.getElementById("replyForm");o&&o.addEventListener("submit",function(t){t.preventDefault();var t=o.getAttribute("data-thread-id")||document.querySelector('meta[name="thread-id"]')?.content,r=document.getElementById("replyContent").value.trim(),n=document.getElementById("replyAnonymous")?.checked||!1;if(t)if(r){let e=o.querySelector('button[type="submit"]');e&&(e.disabled=!0),createReply(t,r,n).then(()=>{o.reset(),e&&(e.disabled=!1),location.reload()}).catch(()=>{e&&(e.disabled=!1)})}else alert("Reply content is required.");else console.error("Thread ID not found"),alert("Thread ID not found. Please refresh the page and try again.")}),document.querySelectorAll(".nested-reply-form").forEach(a=>{a.addEventListener("submit",function(t){t.preventDefault();var t=a.getAttribute("data-thread-id")||document.querySelector('meta[name="thread-id"]')?.content,r=a.getAttribute("data-parent-id"),n=a.querySelector("textarea").value.trim(),o=a.querySelector('input[type="checkbox"]')?.checked||!1;if(t)if(r)if(n){let e=a.querySelector('button[type="submit"]');e&&(e.disabled=!0),createReply(t,n,o,r).then(()=>{a.reset(),e&&(e.disabled=!1),location.reload()}).catch(()=>{e&&(e.disabled=!1)})}else alert("Reply content is required.");else console.error("Parent reply ID not found"),alert("Parent reply ID not found. Please refresh the page and try again.");else console.error("Thread ID not found for nested reply"),alert("Thread ID not found. Please refresh the page and try again.")})})});