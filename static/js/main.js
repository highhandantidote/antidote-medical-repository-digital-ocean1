function updateViewCount(e,t){e&&t&&fetch(`/api/${e}/${t}/view`,{method:"POST",headers:{"Content-Type":"application/json"}}).catch(e=>{console.error("Error updating view count:",e)})}function formatCurrency(e,t=!1){return"number"==typeof e&&(e=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),t)?`<span class="price-display">${e}</span>`:e}function formatDate(e){return e?(e=new Date(e),new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}).format(e)):""}function truncateText(e,t){return!e||e.length<=t?e:e.substr(0,t)+"..."}document.addEventListener("DOMContentLoaded",function(){console.log("DOM loaded"),document.querySelectorAll("*").forEach(function(e){e.textContent.includes("â‚¹")&&e.classList.add("price-display")});var e=document.getElementById("image");let t=document.getElementById("image-preview-container"),o=document.getElementById("image-preview"),n=(e&&t&&o&&e.addEventListener("change",function(){var e;this.files&&this.files[0]?((e=new FileReader).onload=function(e){o.src=e.target.result,t.style.display="block"},e.readAsDataURL(this.files[0])):t.style.display="none"}),(e=document.querySelector(".create-thread-btn"))?e.addEventListener("click",()=>{console.log("Create Thread clicked"),window.location.href="/community/new"}):console.log("Create Thread button not found"),0<(e=document.querySelectorAll(".actions button")).length?(console.log("Found action buttons:",e.length),e.forEach(o=>{o.addEventListener("click",e=>{console.log("Action clicked:",e.target.textContent);var e=e.target.textContent.toLowerCase(),t=o.closest("tr")?.dataset.threadId;t?(console.log("Thread ID found:",t),"view"===e?window.location.href="/community/thread/"+t:"edit"===e?window.location.href="/dashboard/community/edit/"+t:"delete"===e&&confirm("Are you sure you want to delete this thread?")&&fetch("/api/community/"+t,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success?location.reload():alert("Error deleting thread: "+(e.message||"Unknown error"))}).catch(e=>{console.error("Error:",e),alert("An error occurred while deleting the thread.")})):console.log("Thread ID not found for action:",e)})})):console.log("No action buttons found"),// Feather icons handled by feather-fix.js
"undefined"!=typeof bootstrap&&bootstrap.Tooltip&&[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(e=>new bootstrap.Tooltip(e)),document.querySelector(".navbar-toggler")),r=document.querySelector("#navbarNav");e=document.querySelectorAll(".navbar-nav .nav-link"),n&&r&&(document.addEventListener("click",function(e){"true"!==n.getAttribute("aria-expanded")||r.contains(e.target)||n.contains(e.target)||new bootstrap.Collapse(r).hide()}),e.forEach(e=>{e.addEventListener("click",function(){"none"!==window.getComputedStyle(n).display&&new bootstrap.Collapse(r).hide()})})),(e=document.getElementById("replyForm"))&&e.addEventListener("submit",function(e){e.preventDefault();var e=document.getElementById("threadId").value,t=document.getElementById("replyContent").value,o=document.getElementById("anonymousReply").checked,n=document.getElementById("parentReplyId").value||null,r=document.getElementById("userId").value;t.trim()?(document.getElementById("replyPhoto").files[0],e={thread_id:parseInt(e),content:t,is_anonymous:o,parent_reply_id:n?parseInt(n):null},r&&""!==r.trim()&&(e.user_id=parseInt(r)),fetch("/api/community-replies",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.success?window.location.reload():alert("Error posting reply: "+e.message)}).catch(e=>{console.error("Error:",e),alert("An error occurred while submitting your reply.")})):alert("Please enter your message before submitting.")}),document.querySelectorAll(".media-preview-trigger").forEach(e=>{e.addEventListener("click",function(){var e,o=this.getAttribute("data-media-type"),n=this.getAttribute("data-media-url"),r=document.getElementById("mediaPreviewModal");if(r){let t=r.querySelector(".modal-body");t.innerHTML="","photo"===o?((e=document.createElement("img")).src=n,e.classList.add("img-fluid"),t.appendChild(e)):"video"===o&&((e=document.createElement("iframe")).src=n,e.classList.add("w-100"),e.style.height="400px",e.setAttribute("allowfullscreen",!0),t.appendChild(e)),new bootstrap.Modal(r).show(),r.addEventListener("hidden.bs.modal",function(){t.innerHTML="",document.body.style.overflow="",document.body.style.paddingRight="";var e=document.querySelector(".modal-backdrop");e&&e.remove()},{once:!0})}})}),(e=document.getElementById("procedureSearch"))&&e.addEventListener("input",function(){let n=this.value.toLowerCase(),e=document.querySelectorAll(".procedure-card"),r=!1,t=(e.forEach(e=>{var t=e.querySelector(".card-title").textContent.toLowerCase(),o=e.querySelector(".card-text").textContent.toLowerCase();t.includes(n)||o.includes(n)?(e.style.display="",r=!0):e.style.display="none"}),document.getElementById("noResultsMessage"));r?t&&t.remove():t||((t=document.createElement("div")).id="noResultsMessage",t.className="col-12 mt-3",t.innerHTML='<div class="alert alert-info">No procedures found matching your search.</div>',document.getElementById("procedureList").appendChild(t))}),(e=document.getElementById("applyFilters"))&&e.addEventListener("click",function(){let r=document.getElementById("locationFilter").value,a=document.getElementById("specialtyFilter").value,e=document.querySelector('input[name="ratingFilter"]:checked'),l=e?e.value:"",d=(e=document.querySelectorAll(".doctor-card"),0),t=(e.forEach(e=>{var t=e.dataset.location,o=e.dataset.specialty,n=parseFloat(e.dataset.rating),t=!r||t===r,o=!a||o===a,n=!l||n>=parseFloat(l);t&&o&&n?(e.style.display="",d++):e.style.display="none"}),document.getElementById("noResultsMessage"));0===d?t||((t=document.createElement("div")).id="noResultsMessage",t.className="col-12 mt-3",t.innerHTML='<div class="alert alert-info">No doctors found matching your criteria.</div>',document.getElementById("doctorList").appendChild(t)):t&&t.remove()}),document.querySelectorAll(".card").forEach(e=>{e.addEventListener("mouseenter",function(){this.style.transform="translateY(-5px)",this.style.boxShadow="0 10px 20px rgba(0, 0, 0, 0.2)"}),e.addEventListener("mouseleave",function(){this.style.transform="",this.style.boxShadow=""})}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){var t=this.getAttribute("href");"#"!==t&&document.querySelector(t)&&(e.preventDefault(),document.querySelector(t).scrollIntoView({behavior:"smooth"}))})}),e=document.querySelectorAll(".needs-validation"),Array.from(e).forEach(t=>{t.addEventListener("submit",e=>{t.checkValidity()||(e.preventDefault(),e.stopPropagation()),t.classList.add("was-validated")},!1)}),[...e=document.querySelectorAll(".dropdown-toggle")].map(e=>"undefined"!=typeof bootstrap&&bootstrap.Dropdown?new bootstrap.Dropdown(e):null),document.querySelectorAll(".reply-form").forEach(n=>{n.addEventListener("submit",e=>{e.preventDefault();var e=n.dataset.threadId,t=n.querySelector("textarea").value,o=document.getElementById("reply_csrf_token").value;fetch(`/api/community/${e}/replies`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":o},body:JSON.stringify({content:t,is_anonymous:!1,csrf_token:o})}).then(t=>t.ok?t.json():t.text().then(e=>{throw console.error("Response error:",e),new Error("Server error: "+t.status)})).then(e=>{e.success?location.reload():alert(e.message)}).catch(e=>{console.error("Error:",e),alert("Error posting reply. Please try again later.")})})}),console.log("Setting up dashboard button handlers"),document.querySelectorAll(".btn-outline-info").forEach(e=>{"view"===e.textContent.trim().toLowerCase()&&(console.log("Found View button, setting handler"),e.addEventListener("click",function(e){console.log("View button clicked")}))}),document.querySelectorAll(".btn-outline-warning").forEach(e=>{console.log("Found Edit button, setting handler"),e.addEventListener("click",function(e){e.preventDefault();var t,e=this.getAttribute("data-action")||this.textContent.trim().toLowerCase(),o=this.getAttribute("data-id");console.log("Action clicked:",e,"ID:",o),(e=this.closest("tr"))?(t=e.dataset.threadId||o)&&(e.dataset.threadId||this.classList.contains("community-action"))?(console.log("Editing thread:",t),window.location.href="/dashboard/community/edit/"+t):(t=e.dataset.id||o)&&(e.dataset.id||this.closest("#procedures"))?(console.log("Editing procedure:",t),window.location.href="/admin/procedures/edit/"+t):this.getAttribute("href")&&"#"!==this.getAttribute("href")?window.location.href=this.getAttribute("href"):console.error("Unable to determine what to edit. No ID or href found."):console.error("No parent row found for this button")})}),document.querySelectorAll(".btn-outline-danger").forEach(e=>{console.log("Found Delete button, setting handler"),e.addEventListener("click",function(e){e.preventDefault();var t,e=this.getAttribute("data-action")||this.textContent.trim().toLowerCase(),o=this.getAttribute("data-id");console.log("Action clicked:",e,"ID:",o),(e=this.closest("tr"))?(t=e.dataset.threadId||o)&&(e.dataset.threadId||this.classList.contains("community-action"))?(console.log("Deleting thread:",t),confirm("Are you sure you want to delete this thread?")&&fetch("/api/community/"+t,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success?location.reload():alert("Error deleting thread: "+(e.message||"Unknown error"))}).catch(e=>{console.error("Error:",e),alert("An error occurred while deleting the thread.")})):(t=e.dataset.id||o)&&(e.dataset.id||this.closest("#procedures"))&&(console.log("Deleting procedure:",t),confirm("Are you sure you want to delete this procedure? This action cannot be undone."))&&fetch("/admin/procedures/delete/"+t,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success?(alert("Procedure deleted successfully"),location.reload()):alert("Error deleting procedure: "+(e.message||"Unknown error"))}).catch(e=>{console.error("Error:",e),alert("An error occurred while deleting the procedure.")}):console.error("No parent row found for this button")})}),e=document.querySelectorAll(".btn-outline-success"),console.log("Found Create Thread buttons:",e.length),e.forEach(e=>{e.textContent.trim().toLowerCase().includes("create thread")&&(console.log("Setting up Create Thread button handler"),e.addEventListener("click",function(e){console.log("Create Thread button clicked"),e.preventDefault(),window.location.href="/dashboard/community/create"}))}),console.log("Antidote platform JavaScript initialized successfully")});