document.addEventListener("DOMContentLoaded",function(){console.log("Lead Details JS loaded");var e=document.querySelector(".lead-detail-page");if(e){let a=e.dataset.leadId;if(a){console.log("Lead detail page loaded for lead ID: "+a);let n=document.getElementById("schedule-form");if(n){let t=document.getElementById("schedule-submit-btn");t.addEventListener("click",function(){var e;console.log("Schedule appointment button clicked"),n.querySelector("#appointment_date").value?(t.disabled=!0,t.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Scheduling...',e=new FormData(n),fetch(`/lead/${a}/update_status`,{method:"POST",body:e,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{console.log("Schedule appointment response:",e),e.success?(alert("Appointment scheduled successfully!"),window.location.reload()):(alert("Error: "+(e.message||"Failed to schedule appointment. Please try again.")),t.disabled=!1,t.innerHTML="Schedule Appointment")}).catch(e=>{console.error("Error:",e),alert("An error occurred while scheduling the appointment. Please try again."),t.disabled=!1,t.innerHTML="Schedule Appointment"})):alert("Please select an appointment date and time.")})}let o=document.getElementById("reschedule-form");if(o){let t=document.getElementById("reschedule-submit-btn");t.addEventListener("click",function(){var e;console.log("Reschedule appointment button clicked"),o.querySelector("#new_appointment_date").value?(t.disabled=!0,t.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Rescheduling...',e=new FormData(o),fetch(`/lead/${a}/update_status`,{method:"POST",body:e,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{console.log("Reschedule appointment response:",e),e.success?(alert("Appointment rescheduled successfully!"),window.location.reload()):(alert("Error: "+(e.message||"Failed to reschedule appointment. Please try again.")),t.disabled=!1,t.innerHTML="Reschedule Appointment")}).catch(e=>{console.error("Error:",e),alert("An error occurred while rescheduling the appointment. Please try again."),t.disabled=!1,t.innerHTML="Reschedule Appointment"})):alert("Please select a new appointment date and time.")})}document.querySelectorAll("a.btn, button.btn").forEach(e=>{e.addEventListener("click",function(e){var t=this.dataset.action;t&&"submit"!==this.type&&(console.log("Button clicked: "+t),"back"!==t)&&(e.preventDefault(),"contact"===t?window.location.href=`/lead/${a}/contact`:"update_status"===t?window.location.href=`/lead/${a}/update_status`:"schedule"===t?new bootstrap.Modal(document.getElementById("scheduleModal")).show():"reschedule"===t&&new bootstrap.Modal(document.getElementById("rescheduleModal")).show())})})}else console.error("No lead ID found")}else console.log("Not on lead detail page")});