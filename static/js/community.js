document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("#createThreadBtn");let l=document.querySelector("#createThreadForm"),d=document.getElementById("createThreadModal"),c;console.log("DOM loaded"),e?(console.log("Found Create Thread button"),e.addEventListener("click",function(e){e.preventDefault(),console.log("Create Thread button clicked"),(c=c||new bootstrap.Modal(d,{backdrop:"static",keyboard:!1})).show()})):console.log("Create Thread button not found"),l?(console.log("Found Create Thread form"),l.addEventListener("submit",function(e){e.preventDefault(),console.log("Form submission intercepted");var e=document.getElementById("threadTitle"),t=document.getElementById("threadContent");if(e&&t){var o=e.value.trim(),n=t.value.trim();if(console.log("Form values:",{titleRaw:e.value,contentRaw:t.value,titleTrimmed:o,contentTrimmed:n,titleLength:o.length,contentLength:n.length}),o&&n){let t=l.querySelector('button[type="submit"]');t.disabled=!0;var r={title:o,content:n},a=document.getElementById("threadCategory"),a=(a&&a.value&&(r.category_id=parseInt(a.value)),document.getElementById("threadProcedure")),a=(a&&a.value&&(r.procedure_id=parseInt(a.value)),document.getElementById("anonymousThread")),a=(a&&(r.is_anonymous=a.checked),console.log("Sending data to server:",r),document.querySelector('input[name="csrf_token"]').value);r.csrf_token=a,fetch("/community/create_thread",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRFToken":a},body:JSON.stringify(r)}).then(e=>(console.log("Response status:",e.status),e.ok||console.error("HTTP error! status:",e.status),e.json())).then(e=>{console.log("Server response:",e),t.disabled=!1,e.success?(d&&c&&c.hide(),l.reset(),alert("Thread created successfully!"),e.thread_id?window.location.href="/community/thread/"+e.thread_id:location.reload()):alert(e.message||"Failed to create thread.")}).catch(e=>{console.error("Fetch error:",e),t.disabled=!1,alert("An error occurred while creating the thread. Check console for details.")})}else alert('Title and content are required. Debug: Title="'+o+'", Content="'+n+'"')}else console.error("Form elements not found:",{titleElement:e?"Found":"Not found",contentElement:t?"Found":"Not found"}),alert("Form elements not found. Please contact support.")})):console.log("Create Thread form not found"),d&&(d.addEventListener("hidden.bs.modal",function(){console.log("Modal hidden event"),c=null}),d.addEventListener("shown.bs.modal",function(){console.log("Modal shown event");var e=document.getElementById("threadTitle");e&&e.focus()}));e=document.querySelectorAll(".thread-action");0<e.length?(console.log("Found action buttons:",e.length),e.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();e=this.getAttribute("data-thread-id");let o=this.getAttribute("data-action");e&&o?fetch(`/community/thread/${e}/`+o,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{var t;e.success?"like"===o?((t=this.querySelector(".count"))&&(t.textContent=e.count||0),this.classList.toggle("active",e.active)):(alert(e.message||"Action successful!"),"delete"===o&&location.reload()):alert(e.message||"Action failed.")}).catch(e=>{console.error("Error:",e),alert("An error occurred. Please try again.")}):console.error("Missing thread ID or action")})})):console.log("No action buttons found"),console.log("Community.js loaded successfully")});