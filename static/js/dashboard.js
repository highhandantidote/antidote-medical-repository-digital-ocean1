document.addEventListener("DOMContentLoaded",function(){let r,n,d;var e=document.getElementById("editReviewModal"),e=(e&&(r=new bootstrap.Modal(e)),document.getElementById("editThreadModal")),e=(e&&(n=new bootstrap.Modal(e)),document.getElementById("editReplyModal")),e=(e&&(d=new bootstrap.Modal(e)),document.querySelectorAll(".appointment-actions .btn").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var e=this.getAttribute("data-id"),t=this.getAttribute("data-action");e&&t?"cancel"===t&&!confirm("Are you sure you want to cancel this appointment?")||"confirm"===t&&!confirm("Confirm this appointment?")||"complete"===t&&!confirm("Mark this appointment as completed?")||fetch(`/appointment/${t}/`+e,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success?(alert(e.message||"Action completed successfully!"),location.reload()):alert(e.message||"Action failed.")}).catch(e=>{console.error("Error:",e),alert("An error occurred while processing your request. Please try again.")}):console.error("Missing appointment ID or action")})}),document.querySelectorAll(".review-actions .btn").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();let t=this.getAttribute("data-id");e=this.getAttribute("data-action");t&&e?"edit"===e?fetch("/review/"+t,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success?(document.getElementById("editReviewId").value=t,document.getElementById("editRating").value=e.review.rating,document.getElementById("editContent").value=e.review.content,r&&r.show()):alert(e.message||"Could not retrieve review data.")}).catch(e=>{console.error("Error:",e),alert("An error occurred while retrieving review data.")}):"delete"===e&&confirm("Are you sure you want to delete this review? This action cannot be undone.")&&fetch("/review/delete/"+t,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success?(alert(e.message||"Review deleted successfully"),location.reload()):alert(e.message||"Failed to delete review")}).catch(e=>{console.error("Error:",e),alert("An error occurred while deleting the review.")}):console.error("Missing review ID or action")})}),document.getElementById("editReviewForm")),e=(e&&e.addEventListener("submit",function(e){e.preventDefault();var e=document.getElementById("editReviewId").value,t=document.getElementById("editRating").value,o=document.getElementById("editContent").value;e&&t&&o?fetch("/review/edit/"+e,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify({rating:t,content:o})}).then(e=>e.json()).then(e=>{e.success?(r&&r.hide(),alert(e.message||"Review updated successfully"),location.reload()):alert(e.message||"Failed to update review")}).catch(e=>{console.error("Error:",e),alert("An error occurred while updating the review.")}):alert("All fields are required")}),document.querySelectorAll(".community-actions .btn").forEach(e=>{console.log("Setting up community post button:",e.getAttribute("data-action")),e.addEventListener("click",function(e){e.preventDefault();let t=this.getAttribute("data-id");e=this.getAttribute("data-action");console.log("Action clicked:",e,"Thread ID:",t),t&&e?(this.closest(".community-post-card")||console.error("No parent row found for this button"),"view"===e?(console.log("View button clicked"),window.location.href="/community/thread/"+t):"edit"===e?(console.log("Edit button clicked"),fetch("/community/thread/"+t,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success?(console.log("Thread data received:",e),document.getElementById("editThreadId").value=t,document.getElementById("editThreadTitle").value=e.thread.title,document.getElementById("editThreadContent").value=e.thread.content,n?n.show():(console.error("Edit thread modal not initialized"),alert("Error: Could not open edit form. Please try again."))):(console.error("Failed to get thread data:",e.message),alert(e.message||"Failed to load thread data."))}).catch(e=>{console.error("Error fetching thread data:",e),alert("An error occurred while loading thread data.")})):"delete"===e&&(console.log("Delete button clicked"),confirm("Are you sure you want to delete this thread? This cannot be undone."))&&fetch("/community/delete_thread/"+t,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{console.log("Delete response:",e),e.success?(alert(e.message||"Thread deleted successfully!"),location.reload()):alert(e.message||"Failed to delete thread.")}).catch(e=>{console.error("Error deleting thread:",e),alert("An error occurred while deleting the thread.")})):console.error("Missing thread ID or action")})}),document.getElementById("editThreadForm")),e=(e?(console.log("Found edit thread form, setting up submission handler"),e.addEventListener("submit",function(e){e.preventDefault();var e=document.getElementById("editThreadId").value,t=document.getElementById("editThreadTitle").value.trim(),o=document.getElementById("editThreadContent").value.trim();console.log("Submitting thread edit:",{threadId:e,title:t,content:o}),e&&t&&o?fetch("/community/edit_thread/"+e,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({title:t,content:o})}).then(e=>e.json()).then(e=>{console.log("Edit response:",e),e.success?(n&&n.hide(),alert(e.message||"Thread updated successfully!"),location.reload()):alert(e.message||"Failed to update thread.")}).catch(e=>{console.error("Error updating thread:",e),alert("An error occurred while updating the thread.")}):alert("Title and content are required.")})):console.log("Edit thread form not found"),document.querySelectorAll('[data-action="edit-reply"], [data-action="delete-reply"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();let t=this.getAttribute("data-id");e=this.getAttribute("data-action");console.log("Reply action clicked:",e,"Reply ID:",t),t&&e?"edit-reply"===e?(console.log("Edit reply button clicked"),fetch("/api/community-replies/"+t,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success?(console.log("Reply data received:",e),document.getElementById("editReplyId").value=t,document.getElementById("editReplyContent").value=e.reply.content,d?d.show():(console.error("Edit reply modal not initialized"),alert("Error: Could not open edit form. Please try again."))):(console.error("Failed to get reply data:",e.message),alert(e.message||"Failed to load reply data."))}).catch(e=>{console.error("Error fetching reply data:",e),alert("An error occurred while loading reply data.")})):"delete-reply"===e&&(console.log("Delete reply button clicked"),confirm("Are you sure you want to delete this reply? This cannot be undone."))&&fetch("/community/reply/delete/"+t,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{console.log("Delete response:",e),e.success?(alert(e.message||"Reply deleted successfully!"),location.reload()):alert(e.message||"Failed to delete reply.")}).catch(e=>{console.error("Error deleting reply:",e),alert("An error occurred while deleting the reply.")}):console.error("Missing reply ID or action")})}),document.getElementById("editReplyForm"));e&&(console.log("Found edit reply form, setting up submission handler"),e.addEventListener("submit",function(e){e.preventDefault();var e=document.getElementById("editReplyId").value,t=document.getElementById("editReplyContent").value.trim(),o=this.querySelector('input[name="csrf_token"]').value;console.log("Submitting reply edit:",{replyId:e,content:t}),e&&t?fetch("/community/reply/edit/"+e,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRFToken":o},body:JSON.stringify({content:t,csrf_token:o})}).then(e=>e.json()).then(e=>{console.log("Edit response:",e),e.success?(d&&d.hide(),alert(e.message||"Reply updated successfully!"),location.reload()):alert(e.message||"Failed to update reply.")}).catch(e=>{console.error("Error updating reply:",e),alert("An error occurred while updating the reply.")}):alert("Reply content is required.")})),console.log("Dashboard.js initialized: Set up action handlers for appointments, reviews, community posts and replies")});