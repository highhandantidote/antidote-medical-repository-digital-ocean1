function initializeTrendingTopicsChart(){console.log("Initializing trending topics chart...");try{var o=document.getElementById("trendingTopicsChart");if(o){var i=JSON.parse(o.dataset.topics||"[]");if(console.log("Trending topics data:",i),0===i.length)console.log("No trending topics data available.");else{let t,e;e=i[0]&&"object"==typeof i[0]&&i[0].hasOwnProperty("topic")?(console.log("Using object format for topics (topic/count)"),t=i.map(t=>t.topic),i.map(t=>t.count)):(console.log("Using array format for topics [topic, count]"),t=i.map(t=>t[0]),i.map(t=>t[1])),new Chart(o.getContext("2d"),{type:"bar",data:{labels:t,datasets:[{label:"Mentions",data:e,backgroundColor:"rgba(54, 162, 235, 0.7)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0},grid:{color:"rgba(255, 255, 255, 0.1)"}},x:{grid:{color:"rgba(255, 255, 255, 0.1)"}}},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleFont:{size:14},bodyFont:{size:13},padding:10,callbacks:{label:function(t){return t.parsed.y+" mentions"}}},title:{display:!0,text:"Top Trends",color:"#666",font:{size:14},padding:{bottom:10}}}}}),console.log("Trending topics chart initialized successfully")}}else console.error("Trending topics chart element not found")}catch(t){console.error("Error initializing trending topics chart:",t)}}function initializeBodyPartDistributionChart(){console.log("Initializing body part distribution chart...");try{var o=document.getElementById("bodyPartDistributionChart");if(o){var i=JSON.parse(o.dataset.distribution||"[]");if(console.log("Body part distribution data:",i),0===i.length)console.log("No body part distribution data available.");else{let t,e;e=i[0]&&"object"==typeof i[0]&&i[0].hasOwnProperty("body_part")?(console.log("Using object format for distribution (body_part/count)"),t=i.map(t=>t.body_part),i.map(t=>t.count)):(console.log("Using array format for distribution [body_part, count]"),t=i.map(t=>t[0]),i.map(t=>t[1]));var r=["rgba(54, 162, 235, 0.7)","rgba(255, 99, 132, 0.7)","rgba(75, 192, 192, 0.7)","rgba(255, 206, 86, 0.7)","rgba(153, 102, 255, 0.7)","rgba(255, 159, 64, 0.7)","rgba(199, 199, 199, 0.7)","rgba(83, 102, 255, 0.7)","rgba(78, 205, 196, 0.7)","rgba(255, 99, 71, 0.7)"],a=r.map(t=>t.replace("0.7","1"));new Chart(o.getContext("2d"),{type:"pie",data:{labels:t,datasets:[{data:e,backgroundColor:r.slice(0,e.length),borderColor:a.slice(0,e.length),borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:10,right:20,bottom:10,left:10}},plugins:{legend:{position:"right",labels:{boxWidth:15,padding:10,font:{size:12}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleFont:{size:14},bodyFont:{size:13},padding:10,callbacks:{label:function(t){var e=t.label||"",o=t.raw||0,t=t.dataset.data.reduce((t,e)=>t+e,0);return e+`: ${o} threads (${Math.round(o/t*100)}%)`}}},title:{display:!0,text:"Thread Distribution",color:"#666",font:{size:14},padding:{bottom:10}}}}}),console.log("Body part distribution chart initialized successfully")}}else console.error("Body part distribution chart element not found")}catch(t){console.error("Error initializing body part distribution chart:",t)}}function initializeBodyPartFilter(){console.log("Initializing body part filter...");try{var t=document.getElementById("bodyPartFilter");let r=document.querySelectorAll(".thread-item");t&&0!==r.length?(t.addEventListener("change",function(){let o=this.value;var t=new Date;console.log(`[${t.toISOString()}] Filter changed to: `+(o||"All"));let i=!1;r.forEach(t=>{var e=t.dataset.bodyPart;o&&e!==o?t.style.display="none":(t.style.display="",i=!0)});var e,t=document.getElementById("noFilterResults");i?t&&t.remove():t||(t=document.getElementById("threadList"))&&((e=document.createElement("div")).id="noFilterResults",e.className="list-group-item text-center py-3",e.innerHTML='<p class="mb-0">No threads found for the selected body part. Try a different filter.</p>',t.appendChild(e))}),console.log("Body part filter initialized successfully")):console.log("Body part filter elements not found, skipping initialization")}catch(t){console.error("Error initializing body part filter:",t)}}function initializeRefreshButton(){console.log("Initializing refresh button...");try{var t=document.getElementById("refreshAnalyticsButton");t?(t.addEventListener("click",function(){refreshAnalyticsData()}),console.log("Refresh button initialized successfully")):console.log("Refresh button not found, skipping initialization")}catch(t){console.error("Error initializing refresh button:",t)}}function refreshAnalyticsData(){console.log("Refreshing analytics data...");try{var e=new Date;console.log(`[${e.toISOString()}] Refreshing analytics data...`);let t=document.getElementById("refreshingIndicator"),o=(t&&t.classList.remove("d-none"),document.getElementById("lastUpdatedTime"));fetch("/api/community/trends").then(t=>{if(t.ok)return t.json();throw new Error("HTTP error "+t.status)}).then(t=>{var e;t.success?(console.log("Received updated data:",t),updateTrendingTopicsChart((e=t.data).trending_topics),updateBodyPartDistributionChart(e.body_part_distribution),updateStatistics(e.stats),o&&(e=new Date,o.textContent=e.toLocaleTimeString()),console.log("Analytics data refreshed successfully")):console.error("Failed to refresh analytics data:",t.message)}).catch(t=>{console.error("Error refreshing analytics data:",t)}).finally(()=>{t&&t.classList.add("d-none")})}catch(t){console.error("Error in refreshAnalyticsData:",t);e=document.getElementById("refreshingIndicator");e&&e.classList.add("d-none")}}function updateTrendingTopicsChart(t){console.log("Updating trending topics chart...");try{var e=document.getElementById("trendingTopicsChart");e?t&&0!==t.length?(e.dataset.topics=JSON.stringify(t),initializeTrendingTopicsChart(),console.log("Trending topics chart updated successfully")):console.log("No trending topics data available for update"):console.error("Trending topics chart element not found")}catch(t){console.error("Error updating trending topics chart:",t)}}function updateBodyPartDistributionChart(t){console.log("Updating body part distribution chart...");try{var e=document.getElementById("bodyPartDistributionChart");e?t&&0!==t.length?(e.dataset.distribution=JSON.stringify(t),initializeBodyPartDistributionChart(),console.log("Body part distribution chart updated successfully")):console.log("No body part distribution data available for update"):console.error("Body part distribution chart element not found")}catch(t){console.error("Error updating body part distribution chart:",t)}}function updateStatistics(t){console.log("Updating statistics...");try{var e,o,i;t?((e=document.querySelector('.card-body h2[data-stat="thread-count"]'))&&void 0!==t.thread_count&&(e.textContent=t.thread_count),(o=document.querySelector('.card-body h2[data-stat="reply-count"]'))&&void 0!==t.total_replies&&(o.textContent=t.total_replies),(i=document.querySelector('.card-body h2[data-stat="view-count"]'))&&void 0!==t.total_views&&(i.textContent=t.total_views),console.log("Statistics updated successfully")):console.log("No statistics data available for update")}catch(t){console.error("Error updating statistics:",t)}}document.addEventListener("DOMContentLoaded",function(){console.log("DOM loaded, initializing community analytics dashboard..."),initializeTrendingTopicsChart(),initializeBodyPartDistributionChart(),initializeBodyPartFilter(),initializeRefreshButton(),setInterval(refreshAnalyticsData,3e5)});