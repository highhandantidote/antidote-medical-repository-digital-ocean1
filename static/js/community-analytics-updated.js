function debounce(a,n,o){let r;return function(){let t=this,i=arguments;var e=o&&!r;clearTimeout(r),r=setTimeout(function(){r=null,o||a.apply(t,i)},n),e&&a.apply(t,i)}}function logWithTimestamp(t,i){var e=(new Date).toISOString();i?console.log(`[${e}] `+t,i):console.log(`[${e}] `+t)}function initializeLazyChartLoading(){logWithTimestamp("Setting up lazy chart loading"),isElementInViewport(document.getElementById("trendingTopicsChart"))&&(logWithTimestamp("Trending topics chart is visible, initializing immediately"),initializeTrendingTopicsChart()),isElementInViewport(document.getElementById("bodyPartDistributionChart"))&&(logWithTimestamp("Body part distribution chart is visible, initializing immediately"),initializeBodyPartDistributionChart()),window.addEventListener("scroll",debounce(function(){var t=document.getElementById("trendingTopicsChart"),i=document.getElementById("bodyPartDistributionChart");t&&!t.classList.contains("chart-initialized")&&isElementInViewport(t)&&(logWithTimestamp("Trending topics chart scrolled into view, initializing"),initializeTrendingTopicsChart()),i&&!i.classList.contains("chart-initialized")&&isElementInViewport(i)&&(logWithTimestamp("Body part distribution chart scrolled into view, initializing"),initializeBodyPartDistributionChart())},200))}function isElementInViewport(t){return!!t&&0<=(t=t.getBoundingClientRect()).top&&0<=t.left&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function initializeTrendingTopicsChart(){logWithTimestamp("Initializing trending topics chart...");try{var e=document.getElementById("trendingTopicsChart");if(e){e.classList.add("chart-initialized");var a=JSON.parse(e.dataset.topics||"[]");if(logWithTimestamp("Trending topics data:",a),0===a.length)logWithTimestamp("No trending topics data available.");else{var n=performance.now();let t,i;i=a[0]&&"object"==typeof a[0]&&a[0].hasOwnProperty("topic")?(logWithTimestamp("Using object format for topics (topic/count)"),t=a.map(t=>t.topic),a.map(t=>t.count)):(logWithTimestamp("Using array format for topics [topic, count]"),t=a.map(t=>t[0]),a.map(t=>t[1])),new Chart(e.getContext("2d"),{type:"bar",data:{labels:t,datasets:[{label:"Mentions",data:i,backgroundColor:"rgba(54, 162, 235, 0.7)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0},grid:{color:"rgba(255, 255, 255, 0.1)"}},x:{grid:{color:"rgba(255, 255, 255, 0.1)"}}},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleFont:{size:14},bodyFont:{size:13},padding:10,callbacks:{label:function(t){return t.parsed.y+" mentions"}}},title:{display:!0,text:"Top Trends",color:"#666",font:{size:14},padding:{bottom:10}}}}}),logWithTimestamp(`Trending topics chart initialized successfully in ${(performance.now()-n).toFixed(2)}ms`)}}else logWithTimestamp("Trending topics chart element not found")}catch(t){logWithTimestamp("Error initializing trending topics chart:",t)}}function initializeBodyPartDistributionChart(){logWithTimestamp("Initializing body part distribution chart...");try{var e=document.getElementById("bodyPartDistributionChart");if(e){e.classList.add("chart-initialized");var a=JSON.parse(e.dataset.distribution||"[]");if(logWithTimestamp("Body part distribution data:",a),0===a.length)logWithTimestamp("No body part distribution data available.");else{var n=performance.now();let t,i;i=a[0]&&"object"==typeof a[0]&&a[0].hasOwnProperty("body_part")?(logWithTimestamp("Using object format for distribution (body_part/count)"),t=a.map(t=>t.body_part),a.map(t=>t.count)):(logWithTimestamp("Using array format for distribution [body_part, count]"),t=a.map(t=>t[0]),a.map(t=>t[1]));var o=["rgba(54, 162, 235, 0.7)","rgba(255, 99, 132, 0.7)","rgba(75, 192, 192, 0.7)","rgba(255, 206, 86, 0.7)","rgba(153, 102, 255, 0.7)","rgba(255, 159, 64, 0.7)","rgba(199, 199, 199, 0.7)","rgba(83, 102, 255, 0.7)","rgba(78, 205, 196, 0.7)","rgba(255, 99, 71, 0.7)"],r=o.map(t=>t.replace("0.7","1"));new Chart(e.getContext("2d"),{type:"pie",data:{labels:t,datasets:[{data:i,backgroundColor:o.slice(0,i.length),borderColor:r.slice(0,i.length),borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:10,right:20,bottom:10,left:10}},plugins:{legend:{position:"right",labels:{boxWidth:15,padding:10,font:{size:12}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleFont:{size:14},bodyFont:{size:13},padding:10,callbacks:{label:function(t){var i=t.label||"",e=t.raw||0,t=t.dataset.data.reduce((t,i)=>t+i,0);return i+`: ${e} threads (${Math.round(e/t*100)}%)`}}},title:{display:!0,text:"Thread Distribution",color:"#666",font:{size:14},padding:{bottom:10}}}}}),logWithTimestamp(`Body part distribution chart initialized successfully in ${(performance.now()-n).toFixed(2)}ms`)}}else logWithTimestamp("Body part distribution chart element not found")}catch(t){logWithTimestamp("Error initializing body part distribution chart:",t)}}function initializeBodyPartFilter(){logWithTimestamp("Initializing body part filter...");try{var t=document.getElementById("bodyPartFilter");let r=document.querySelectorAll(".thread-item");t&&0!==r.length?(t.addEventListener("change",debounce(function(){let e=this.value;var t=performance.now();logWithTimestamp("Filter changed to: "+(e||"All"));let a=!1,n=0;r.forEach(t=>{var i=t.dataset.bodyPart;e&&i!==e?t.style.display="none":(t.style.display="",a=!0,n++)});var i,o=document.getElementById("noFilterResults");a?o&&o.remove():o||(o=document.getElementById("threadList"))&&((i=document.createElement("div")).id="noFilterResults",i.className="list-group-item text-center py-3",i.innerHTML='<p class="mb-0">No threads found for the selected body part. Try a different filter.</p>',o.appendChild(i)),logWithTimestamp(`Filter applied in ${(performance.now()-t).toFixed(2)}ms, showing ${n} threads`)},100)),logWithTimestamp("Body part filter initialized successfully")):logWithTimestamp("Body part filter elements not found, skipping initialization")}catch(t){logWithTimestamp("Error initializing body part filter:",t)}}function initializeRefreshButton(){logWithTimestamp("Initializing refresh button...");try{var t=document.getElementById("refreshAnalyticsButton");t?(t.addEventListener("click",function(){logWithTimestamp("Refresh button clicked by user"),refreshAnalyticsData()}),logWithTimestamp("Refresh button initialized successfully")):logWithTimestamp("Refresh button not found, skipping initialization")}catch(t){logWithTimestamp("Error initializing refresh button:",t)}}function refreshAnalyticsData(){logWithTimestamp("Refreshing analytics data...");try{let e=performance.now(),t=document.getElementById("refreshingIndicator"),a=(t&&t.classList.remove("d-none"),document.getElementById("lastUpdatedTime"));fetch("/api/community/trends").then(t=>{if(t.ok)return t.json();throw new Error("HTTP error "+t.status)}).then(t=>{var i;logWithTimestamp(`API call completed in ${(performance.now()-e).toFixed(2)}ms`),t.success?(logWithTimestamp("Received updated data"),updateTrendingTopicsChart((i=t.data).trending_topics),updateBodyPartDistributionChart(i.body_part_distribution),updateStatistics(i.stats),a&&(i=new Date,a.textContent=i.toLocaleTimeString()),logWithTimestamp("Analytics data refreshed successfully")):logWithTimestamp("Failed to refresh analytics data:",t.message)}).catch(t=>{logWithTimestamp("Error refreshing analytics data:",t)}).finally(()=>{t&&t.classList.add("d-none")})}catch(t){logWithTimestamp("Error in refreshAnalyticsData:",t);var i=document.getElementById("refreshingIndicator");i&&i.classList.add("d-none")}}function updateTrendingTopicsChart(t){logWithTimestamp("Updating trending topics chart...");try{var i=document.getElementById("trendingTopicsChart");i?t&&0!==t.length?(i.dataset.topics=JSON.stringify(t),i.classList.remove("chart-initialized"),initializeTrendingTopicsChart(),logWithTimestamp("Trending topics chart updated successfully")):logWithTimestamp("No trending topics data available for update"):logWithTimestamp("Trending topics chart element not found")}catch(t){logWithTimestamp("Error updating trending topics chart:",t)}}function updateBodyPartDistributionChart(t){logWithTimestamp("Updating body part distribution chart...");try{var i=document.getElementById("bodyPartDistributionChart");i?t&&0!==t.length?(i.dataset.distribution=JSON.stringify(t),i.classList.remove("chart-initialized"),initializeBodyPartDistributionChart(),logWithTimestamp("Body part distribution chart updated successfully")):logWithTimestamp("No body part distribution data available for update"):logWithTimestamp("Body part distribution chart element not found")}catch(t){logWithTimestamp("Error updating body part distribution chart:",t)}}function updateStatistics(t){if(t)try{var i=document.getElementById("threadCount"),e=document.getElementById("viewCount"),a=document.getElementById("replyCount");i&&(i.textContent=t.thread_count||0),e&&(e.textContent=t.total_views||0),a&&(a.textContent=t.total_replies||0),logWithTimestamp("Statistics updated successfully")}catch(t){logWithTimestamp("Error updating statistics:",t)}}document.addEventListener("DOMContentLoaded",function(){logWithTimestamp("DOM loaded, initializing community analytics dashboard..."),initializeLazyChartLoading(),initializeBodyPartFilter(),initializeRefreshButton();setInterval(function(){logWithTimestamp("Auto-refreshing analytics data after 5 minutes"),refreshAnalyticsData()},3e5),logWithTimestamp("Community analytics dashboard initialization complete")});