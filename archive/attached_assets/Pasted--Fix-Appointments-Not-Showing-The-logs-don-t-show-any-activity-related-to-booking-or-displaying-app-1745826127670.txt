. Fix Appointments Not Showing
The logs don't show any activity related to booking or displaying appointments, and you previously noted that the "Upcoming Appointments" and "Past Appointments" sections show "No upcoming appointments" despite booking one as testuser.

Verify Appointment Data
Check if the appointment exists in the database:
Run:
text

Copy
SELECT * FROM appointment WHERE doctor_id = 1;
If no results appear, the booking process is likely still broken.
Ensure Booking Route Works
Replit didn't implement the booking route as suggested. Let's add it to routes.py. Open routes.py and add the following route after the register route:
text

Copy
from datetime import datetime

@web.route('/book_appointment/<int:doctor_id>', methods=['GET', 'POST'])
@login_required
def book_appointment(doctor_id):
    doctor = Doctor.query.get_or_404(doctor_id)
    if current_user.role != 'user':
        flash('Only patients can book appointments.', 'danger')
        return redirect(url_for('web.index'))
    if request.method == 'POST':
        procedure_name = request.form.get('procedure_name')
        appointment_date = request.form.get('appointment_date')
        appointment_time = request.form.get('appointment_time')
        appointment = Appointment(
            user_id=current_user.id,
            doctor_id=doctor.id,
            procedure_name=procedure_name,
            appointment_date=datetime.strptime(appointment_date, '%Y-%m-%d').date(),
            appointment_time=datetime.strptime(appointment_time, '%H:%M').time(),
            status='pending'
        )
        db.session.add(appointment)
        db.session.commit()
        flash('Appointment booked successfully!', 'success')
        return redirect(url_for('web.index'))
    return render_template('book_appointment.html', doctor=doctor)
Create templates/book_appointment.html:
text

Copy
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book Appointment - {{ doctor.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Book Appointment with {{ doctor.name }}</h2>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <form method="POST" action="{{ url_for('web.book_appointment', doctor_id=doctor.id) }}">
            <div class="mb-3">
                <label for="procedure_name" class="form-label">Procedure</label>
                <input type="text" name="procedure_name" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="appointment_date" class="form-label">Date</label>
                <input type="date" name="appointment_date" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="appointment_time" class="form-label">Time</label>
                <input type="time" name="appointment_time" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary">Book Appointment</button>
        </form>
    </div>
</body>
</html>
Add a link to book an appointment in templates/doctor_detail.html (or wherever users can view doctor details):
text

Copy
<a href="{{ url_for('web.book_appointment', doctor_id=doctor.id) }}" class="btn btn-primary">Book Appointment</a>
Log in as testuser@antidote.com (password: Test1234), navigate to Dr. John Smith's detail page (likely /doctor/1), click "Book Appointment," and book an appointment for a future date (e.g., 2025-05-01, 10:00, Procedure: Facelift).
Verify the appointment is saved by running the SQL query again.
Fix Appointment Display
Ensure the doctor_appointments route in routes.py is correct (Replit may have created it, but let's confirm):
text

Copy
from datetime import date

@web.route('/dashboard/doctor/<int:doctor_id>/appointments')
@login_required
def doctor_appointments(doctor_id):
    if current_user.role != 'doctor':
        flash('Unauthorized access. Only doctors can access this dashboard.', 'danger')
        return redirect(url_for('web.index'))
    doctor = Doctor.query.get_or_404(doctor_id)
    if doctor.user_id != current_user.id:
        flash('Unauthorized access. You can only view your own dashboard.', 'danger')
        return redirect(url_for('web.index'))
    today = date.today()
    upcoming_appointments = Appointment.query.filter_by(doctor_id=doctor.id).filter(Appointment.appointment_date >= today).order_by(Appointment.appointment_date.asc()).all()
    past_appointments = Appointment.query.filter_by(doctor_id=doctor.id).filter(Appointment.appointment_date < today).order_by(Appointment.appointment_date.desc()).all()
    return render_template('doctor_appointments.html', doctor=doctor, upcoming_appointments=upcoming_appointments, past_appointments=past_appointments)
Verify templates/doctor_appointments.html matches the structure provided earlier. Replit edited this file to add CSRF tokens, but let's ensure the display logic is intact:
text

Copy
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Doctor Appointments - {{ doctor.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-3">
                <h4>Doctor Profile</h4>
                <p>{{ doctor.name }}</p>
                <p>â˜… {{ doctor.rating }} ({{ doctor.review_count }} reviews)</p>
                <a href="{{ url_for('web.edit_doctor_profile', doctor_id=doctor.id) }}" class="btn btn-outline-primary">Edit Profile</a>

                <h4 class="mt-4">Dashboard Menu</h4>
                <ul class="list-group">
                    <li class="list-group-item"><a href="{{ url_for('web.doctor_dashboard', doctor_id=doctor.id) }}">Overview</a></li>
                    <li class="list-group-item"><a href="{{ url_for('web.doctor_appointments', doctor_id=doctor.id) }}">Appointments</a></li>
                    <li class="list-group-item"><a href="{{ url_for('web.doctor_leads', doctor_id=doctor.id) }}">Patient Leads</a></li>
                    <li class="list-group-item"><a href="{{ url_for('web.doctor_reviews', doctor_id=doctor.id) }}">Reviews</a></li>
                    <li class="list-group-item"><a href="{{ url_for('web.doctor_procedures', doctor_id=doctor.id) }}">My Procedures</a></li>
                    <li class="list-group-item"><a href="{{ url_for('web.doctor_availability', doctor_id=doctor.id) }}">Availability</a></li>
                    <li class="list-group-item"><a href="{{ url_for('web.doctor_gallery', doctor_id=doctor.id) }}">Gallery</a></li>
                    <li class="list-group-item"><a href="{{ url_for('web.doctor_community', doctor_id=doctor.id) }}">Community</a></li>
                    <li class="list-group-item"><a href="{{ url_for('web.doctor_verification', doctor_id=doctor.id) }}">Verification <span class="badge bg-warning">NEW</span></a></li>
                </ul>
            </div>
            <div class="col-md-9">
                <h3>Upcoming Appointments</h3>
                <a href="#" class="btn btn-outline-primary mb-3">View Calendar</a>
                {% if upcoming_appointments %}
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Patient</th>
                                <th>Procedure</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for appointment in upcoming_appointments %}
                                <tr>
                                    <td>{{ appointment.user.name }}</td>
                                    <td>{{ appointment.procedure_name }}</td>
                                    <td>{{ appointment.appointment_date }}</td>
                                    <td>{{ appointment.appointment_time }}</td>
                                    <td>{{ appointment.status }}</td>
                                    <td>
                                        <form method="POST" action="{{ url_for('web.update_appointment_status', appointment_id=appointment.id) }}" style="display:inline;">
                                            {{ form.hidden_tag() }}
                                            <select name="status" onchange="this.form.submit()">
                                                <option value="pending" {% if appointment.status == 'pending' %}selected{% endif %}>Pending</option>
                                                <option value="confirmed" {% if appointment.status == 'confirmed' %}selected{% endif %}>Confirmed</option>
                                                <option value="cancelled" {% if appointment.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
                                            </select>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>No upcoming appointments</p>
                {% endif %}

                <h3>Past Appointments</h3>
                {% if past_appointments %}
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Patient</th>
                                <th>Procedure</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for appointment in past_appointments %}
                                <tr>
                                    <td>{{ appointment.user.name }}</td>
                                    <td>{{ appointment.procedure_name }}</td>
                                    <td>{{ appointment.appointment_date }}</td>
                                    <td>{{ appointment.appointment_time }}</td>
                                    <td>{{ appointment.status }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>No past appointments</p>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>
Add a route to handle appointment status updates in routes.py:
text

Copy
@web.route('/appointment/<int:appointment_id>/update_status', methods=['POST'])
@login_required
def update_appointment_status(appointment_id):
    if current_user.role != 'doctor':
        flash('Unauthorized access. Only doctors can update appointments.', 'danger')
        return redirect(url_for('web.index'))
    appointment = Appointment.query.get_or_404(appointment_id)
    doctor = Doctor.query.filter_by(user_id=current_user.id).first()
    if appointment.doctor_id != doctor.id:
        flash('Unauthorized access.', 'danger')
        return redirect(url_for('web.index'))
    new_status = request.form.get('status')
    appointment.status = new_status
    db.session.commit()
    flash('Appointment status updated!', 'success')
    return redirect(url_for('web.doctor_appointments', doctor_id=doctor.id))
Log in as testdoctor@antidote.com (password: Doctor1234), navigate to the Appointments section of the dashboard (/dashboard/doctor/1/appointments), and confirm the appointment booked by testuser appears under "Upcoming Appointments."