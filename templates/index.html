{% extends 'base.html' %}

{% block title %}Plastic Surgery Marketplace{% endblock %}

{% block head %}
{{ super() }}
<style>
/* Clean Section Card Design */
.section-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

/* Increase Container Width */
.container {
    max-width: 1400px !important;
}

@media (min-width: 1200px) {
    .container {
        max-width: 1400px !important;
    }
}

@media (min-width: 1400px) {
    .container {
        max-width: 1600px !important;
    }
}

/* Featured Treatment Packages desktop margin */
@media (min-width: 769px) {
    .featured-packages-section {
        margin-top: -1rem !important;
    }
}

/* Mobile container adjustments - Full width edge-to-edge */
@media (max-width: 768px) {
    .container {
        max-width: 100% !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        overflow-x: hidden !important;
    }
    
    /* Remove all possible body/html margins on mobile */
    body, html {
        margin: 0 !important;
        padding: 0 !important;
        overflow-x: hidden !important;
    }
    
    /* Featured Treatment Packages mobile margin */
    .featured-packages-section {
        margin-top: -2rem !important;
    }
}

@media (max-width: 576px) {
    .container {
        max-width: 100% !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        overflow-x: hidden !important;
    }
    
    /* Remove all possible body/html margins on small mobile */
    body, html {
        margin: 0 !important;
        padding: 0 !important;
        overflow-x: hidden !important;
    }
}

/* Hero Banner Styles */
.hero-banner-container {
    margin-bottom: 0;
    margin-top: 0px !important;
    /* Remove background and padding to match page background */
    background: transparent;
    border-radius: 0;
    padding: 0;
    box-shadow: none;
}

.hero-banner-container .banner-slider {
    height: 300px !important;
    border-radius: 0;
    overflow: hidden;
    box-shadow: none;
    width: 100%;
    /* Remove negative margins that cause horizontal scroll */
    margin-left: 0;
    margin-right: 0;
    max-width: 100%;
}

/* Ensure hero banner slide content fills the entire container */
.hero-banner-container .banner-slider .slide-content {
    width: 100%;
    height: 300px !important;
    background-size: cover !important;
    background-position: center !important;
    background-repeat: no-repeat !important;
}

@media (max-width: 768px) {
    .hero-banner-container {
        /* Keep transparent background on mobile */
        margin: 0 !important;
        margin-top: 0px !important;
        margin-bottom: 0 !important;
        padding: 0 !important;
        background: transparent !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        overflow: visible !important;
    }
    
    /* FORCE hero search section margin-top to -100px on mobile */
    .hero-search-section {
        margin-top: -100px !important;
        position: relative !important;
        z-index: 10 !important;
    }
    
    .hero-banner-container .banner-slider {
        height: 280px !important;
        border-radius: 0 !important;
        width: 100vw !important;
        /* Use more aggressive negative margins to break out of container */
        margin-left: calc(-50vw + 50%) !important;
        margin-right: calc(-50vw + 50%) !important;
        max-width: 100vw !important;
        overflow: hidden !important;
        box-shadow: none !important;
        position: relative !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
    }
    
    /* Ensure hero banner slide content fills full width on mobile */
    .hero-banner-container .banner-slider .slide-content {
        width: 100%;
        height: 280px !important;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }
    
    /* FORCE hero search section margin-top to -100px on mobile */
    .hero-search-section {
        margin-top: -100px !important;
        position: relative !important;
        z-index: 10 !important;
    }
}

@media (max-width: 576px) {
    .hero-banner-container {
        /* Keep transparent background on small mobile */
        margin: 0 !important;
        margin-top: 0px !important;
        padding: 0 !important;
        background: transparent !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        overflow: visible !important;
    }
    
    .hero-banner-container .banner-slider {
        height: 280px !important;
        border-radius: 0 !important;
        width: 100vw !important;
        /* Use more aggressive negative margins to break out of container */
        margin-left: calc(-50vw + 50%) !important;
        margin-right: calc(-50vw + 50%) !important;
        max-width: 100vw !important;
        overflow: hidden !important;
        box-shadow: none !important;
        position: relative !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
    }
    
    /* Ensure hero banner slide content fills full width on small mobile */
    .hero-banner-container .banner-slider .slide-content {
        width: 100%;
        height: 280px !important;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }
    
    /* FORCE hero search section margin-top to -100px on small mobile */
    .hero-search-section {
        margin-top: -100px !important;
        position: relative !important;
        z-index: 10 !important;
    }
}

/* Hero Banner Direct Styles */
.hero-banner-direct .hero-banner-image {
    transition: transform 0.3s ease;
}

.hero-banner-direct .hero-banner-image:hover {
    transform: translateY(-2px);
}

@media (max-width: 768px) {
    .hero-banner-direct .hero-banner-image {
        height: 250px !important;
    }
    
    .hero-banner-direct .hero-banner-content h2 {
        font-size: 2rem !important;
    }
    
    .hero-banner-direct .hero-banner-content p {
        font-size: 1rem !important;
    }
}

@media (max-width: 576px) {
    .hero-banner-direct .hero-banner-image {
        height: 200px !important;
    }
    
    .hero-banner-direct .hero-banner-content h2 {
        font-size: 1.5rem !important;
    }
    
    .hero-banner-direct .hero-banner-content p {
        font-size: 0.9rem !important;
    }
}

/* Scrollable Grid Styles */
.highlights-grid, .procedures-carousel, .doctors-grid, .packages-grid, .clinics-carousel, .categories-carousel {
    overflow-x: auto;
    display: flex;
    gap: 20px;
    margin-top: 20px;
    padding: 15px 0;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

/* Hide scrollbar for cleaner appearance */
.highlights-grid::-webkit-scrollbar,
.procedures-carousel::-webkit-scrollbar,
.doctors-grid::-webkit-scrollbar,
.packages-grid::-webkit-scrollbar,
.clinics-carousel::-webkit-scrollbar,
.categories-carousel::-webkit-scrollbar {
    height: 6px;
}

.highlights-grid::-webkit-scrollbar-track,
.procedures-carousel::-webkit-scrollbar-track,
.doctors-grid::-webkit-scrollbar-track,
.packages-grid::-webkit-scrollbar-track,
.clinics-carousel::-webkit-scrollbar-track,
.categories-carousel::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.highlights-grid::-webkit-scrollbar-thumb,
.procedures-carousel::-webkit-scrollbar-thumb,
.doctors-grid::-webkit-scrollbar-thumb,
.packages-grid::-webkit-scrollbar-thumb,
.clinics-carousel::-webkit-scrollbar-thumb,
.categories-carousel::-webkit-scrollbar-thumb {
    background: #4A90E2;
    border-radius: 10px;
}

.highlights-grid::-webkit-scrollbar-thumb:hover,
.procedures-carousel::-webkit-scrollbar-thumb:hover,
.doctors-grid::-webkit-scrollbar-thumb:hover,
.packages-grid::-webkit-scrollbar-thumb:hover,
.clinics-carousel::-webkit-scrollbar-thumb:hover,
.categories-carousel::-webkit-scrollbar-thumb:hover {
    background: #357ABD;
}

/* Hero Search Tabs Slider */
.hero-tabs-slider-container {
    position: relative;
}

.hero-tabs-slider {
    display: flex;
    overflow-x: auto;
    overflow-y: hidden;
    white-space: nowrap;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    gap: 0;
    flex-wrap: nowrap !important;
}

.hero-tabs-slider .nav-item {
    flex: 0 0 auto;
    white-space: nowrap;
}

.hero-tabs-slider .nav-link {
    white-space: nowrap;
    padding: 8px 16px;
    border: none;
    background: none;
    margin-right: 4px;
}

/* Hide scrollbar for hero tabs */
.hero-tabs-slider::-webkit-scrollbar {
    display: none;
}

.hero-tabs-slider {
    -ms-overflow-style: none;
    scrollbar-width: none;
}

/* Ensure tabs stay on one line on mobile */
@media (max-width: 768px) {
    .hero-tabs-slider .nav-link {
        padding: 6px 12px;
        font-size: 14px;
    }
}

/* Clinic Cards */
.highlight-item {
    min-width: 280px;
    max-width: 280px;
    text-align: left;
    padding: 25px;
    background: #f8f9fa;
    border-radius: 12px;
    border: 1px solid #dee2e6;
    transition: all 0.3s ease;
    cursor: pointer;
}

.highlight-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 25px rgba(0,0,0,0.12);
    border-color: #4A90E2;
}

/* Procedure Cards */
.procedure-item {
    min-width: 320px;
    max-width: 320px;
    min-height: 180px;
    border: 1px solid #dee2e6;
    border-radius: 12px;
    padding: 20px;
    background: white;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    word-wrap: break-word;
}

.procedure-item-link {
    color: inherit;
}

.procedure-item-link:hover .procedure-item {
    transform: translateY(-3px);
    box-shadow: 0 6px 25px rgba(0,0,0,0.12);
    border-color: #4A90E2;
}

.procedure-item-link:hover {
    color: inherit;
    text-decoration: none;
}

.procedure-item h6 {
    margin-bottom: 12px;
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
    line-height: 1.3;
    color: #333;
}

.procedure-item p {
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
    line-height: 1.4;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

/* Doctor Cards */
.doctors-grid {
    overflow-x: auto;
    display: flex;
    gap: 20px;
    margin-top: 20px;
    padding: 15px 0;
}

.doctor-card {
    min-width: 220px;
    max-width: 220px;
    text-align: center;
    padding: 25px 20px;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 12px;
    height: auto;
    transition: all 0.3s ease;
}

.doctor-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 25px rgba(0,0,0,0.12);
    border-color: #4A90E2;
}

.doctor-avatar {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border: 3px solid #f8f9fa;
    transition: border-color 0.3s ease;
}

.doctor-avatar:hover {
    border-color: #4A90E2;
}

.doctor-name {
    font-size: 0.95rem;
    margin-bottom: 8px;
    line-height: 1.2;
    font-weight: 600;
}

.doctor-qualification {
    font-size: 0.8rem;
    line-height: 1.3;
    color: #666;
}

/* Package Cards - Updated to match packages directory design */
.package-card {
    transition: all 0.3s ease;
    border-left: 4px solid #4A90E2;
}

.package-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
    border-left-color: #357abd;
}

/* Package Items for Carousel */
.package-item {
    min-width: 300px;
    max-width: 300px;
    min-height: 280px;
    border: 1px solid #dee2e6;
    border-radius: 12px;
    padding: 20px;
    background: white;
    transition: all 0.3s ease;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.package-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 25px rgba(0,0,0,0.12);
    border-color: #4A90E2;
}

.packages-carousel {
    overflow-x: auto;
    display: flex;
    gap: 20px;
    padding: 15px 0;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

.packages-carousel::-webkit-scrollbar {
    height: 6px;
}

.packages-carousel::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.packages-carousel::-webkit-scrollbar-thumb {
    background: #4A90E2;
    border-radius: 10px;
}

.packages-carousel::-webkit-scrollbar-thumb:hover {
    background: #357ABD;
}

.title-price-container {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
}

.mobile-price {
    margin-top: 8px;
}

.pricing-section {
    text-align: right;
    flex-shrink: 0;
}

/* Results Section Styling */
.results-section {
    padding-top: 15px;
    border-top: 1px solid #f0f0f0;
}

.results-gallery {
    scrollbar-width: thin;
    scrollbar-color: #4A90E2 #f1f1f1;
}

.results-gallery::-webkit-scrollbar {
    height: 6px;
}

.results-gallery::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.results-gallery::-webkit-scrollbar-thumb {
    background: #4A90E2;
    border-radius: 3px;
}

.result-item {
    min-width: 120px;
    max-width: 120px;
}

.before-after-container {
    display: flex;
    gap: 4px;
    position: relative;
}

.before-image,
.after-image {
    position: relative;
    flex: 1;
}

.before-image img,
.after-image img {
    width: 55px;
    height: 55px;
    object-fit: cover;
    border-radius: 6px;
}

.badge {
    font-size: 0.6rem;
    padding: 2px 4px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .section-card {
        padding: 15px;
        margin-bottom: 10px;
    }
    
    .container {
        padding-left: 1rem;
        padding-right: 1rem;
    }
    
    /* Mobile uniform card width - all cards 260px for consistency */
    .highlight-item,
    .clinic-slider-item,
    .procedure-item,
    .procedure-slider-item,
    .doctor-card,
    .category-slider-item,
    .package-card,
    .package-item {
        min-width: 260px !important;
        max-width: 260px !important;
        min-height: 260px !important;
    }
    
    .highlights-grid,
    .procedures-carousel,
    .doctors-grid,
    .packages-grid,
    .clinics-carousel,
    .categories-carousel {
        padding: 10px 0;
        padding-left: 15px;
        padding-right: 15px;
    }
    
    /* Disable hover effects on mobile for better performance */
    .highlight-item:hover,
    .clinic-slider-item:hover,
    .procedure-item:hover,
    .procedure-slider-item:hover,
    .doctor-card:hover,
    .category-slider-item:hover,
    .package-card:hover,
    .package-item:hover {
        transform: none;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
}

/* Mobile hero search section styling */
@media (max-width: 768px) {
    .hero-search-section {
        padding: 5px !important;
        border-radius: 5px !important;
    }
}

/* Small mobile optimization (576px breakpoint) */
@media (max-width: 576px) {
    .section-card {
        padding: 12px;
        margin-bottom: 8px;
    }
    
    .container {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
    }
    
    .hero-search-section {
        padding: 5px !important;
        border-radius: 5px !important;
    }
    
    /* Small mobile screens - uniform card width for optimal 1.2 card layout */
    .highlight-item,
    .clinic-slider-item,
    .procedure-item,
    .procedure-slider-item,
    .doctor-card,
    .category-slider-item,
    .package-card,
    .package-item {
        min-width: 240px !important;
        max-width: 240px !important;
        min-height: 240px !important;
    }
    
    .highlights-grid,
    .procedures-carousel,
    .doctors-grid,
    .packages-grid,
    .clinics-carousel,
    .categories-carousel {
        padding: 8px 0;
        padding-left: 12px;
        padding-right: 12px;
        gap: 15px;
    }
}

/* Remove excessive spacing below search section */
.hero-search-section {
    margin-bottom: 0 !important;
    background: transparent !important;
}

@media (max-width: 768px) {
    /* Reduce spacing below search section on mobile */
    .hero-search-section {
        margin-bottom: 0 !important;
        padding-bottom: 20px !important;
        background: transparent !important;
    }
    
    /* Eliminate cyan background gap */
    body {
        background: white !important;
    }
    
    /* Fix banner cutting off at top */
    .hero-banner-container .banner-slider .slide-content {
        background-position: center top !important;
        background-size: cover !important;
    }
    
    /* Remove all cyan backgrounds completely */
    .hero-banner-container,
    .hero-banner-container .banner-slider,
    .hero-banner-container .banner-slider .slide,
    .hero-banner-container .banner-slider .slide-content {
        background-color: transparent !important;
    }
    
    /* Hide any banner text overlays completely */
    .banner-text,
    .banner-title,
    .banner-subtitle,
    .banner-overlay,
    .hero-banner-container .banner-text,
    .hero-banner-container .banner-title,
    .hero-banner-container .banner-subtitle,
    .hero-banner-container .banner-overlay {
        display: none !important;
        visibility: hidden !important;
    }
    
    /* Remove spacing after search section container */
    .hero-section-container {
        margin-bottom: 0 !important;
        padding-bottom: 0 !important;
    }
    
    /* Fix main content area background */
    .main-content {
        background: white !important;
    }
    
    /* Ensure no cyan background leaks through */
    .container, .container-fluid {
        background: white !important;
    }
    
    .hero-search-section + * {
        margin-top: 0 !important;
        padding-top: 0 !important;
    }
    
    /* Target the specific col-12 mb-1 container for search */
    .col-12.mb-1 {
        margin-bottom: 0 !important;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="hero-section py-5">
    <!-- Background geometric patterns and shapes -->
    <div class="position-absolute start-0 top-50 translate-middle-y d-none d-xl-block" style="z-index: 0; opacity: 0.5;">
        <svg width="400" height="400" viewBox="0 0 200 200">
            <defs>
                <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#4361ee" stop-opacity="0.1"/>
                    <stop offset="100%" stop-color="#7209b7" stop-opacity="0.1"/>
                </linearGradient>
            </defs>
            <path fill="url(#gradient1)" d="M41.3,-69.8C53.4,-63.5,63.1,-52.2,70.3,-39.2C77.5,-26.1,82.2,-11.3,81,-2.3C79.8,6.8,72.9,13.6,66.7,20.8C60.5,28,55.1,35.6,47.4,41.3C39.7,47,29.8,50.7,19.5,53.9C9.3,57,-1.4,59.5,-13.4,60.2C-25.5,60.9,-38.8,59.8,-47.2,53C-55.5,46.2,-58.9,33.7,-61.5,21.7C-64.2,9.7,-66.2,-1.9,-64.2,-12.8C-62.2,-23.8,-56.3,-34.1,-47.8,-41.1C-39.3,-48.1,-28.3,-51.7,-17.5,-58.3C-6.7,-64.8,4,-74.1,16.1,-76C28.3,-77.8,41.8,-72.2,41.3,-69.8Z" transform="translate(100 100)" />
        </svg>
    </div>
    
    <div class="position-absolute end-0 bottom-0 d-none d-xl-block" style="z-index: 0; opacity: 0.3;">
        <svg width="400" height="400" viewBox="0 0 200 200">
            <defs>
                <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#3b82f6" stop-opacity="0.1"/>
                    <stop offset="100%" stop-color="#10b981" stop-opacity="0.1"/>
                </linearGradient>
            </defs>
            <path fill="url(#gradient2)" d="M54.9,-76.9C71.6,-69.2,85.7,-54.7,93.3,-37.4C100.9,-20,102,-0.7,96.5,15.9C91,32.5,78.9,46.4,64.8,57.1C50.7,67.7,34.7,75.2,17.3,80.8C-0.1,86.5,-18.9,90.2,-35.6,85.7C-52.3,81.2,-67,68.5,-77.9,52.4C-88.8,36.4,-95.9,17,-94.2,-1.7C-92.5,-20.4,-82.1,-38.1,-68.5,-47.5C-54.9,-56.9,-38.1,-58,-23.5,-64.2C-8.9,-70.4,3.6,-81.8,19.5,-85.2C35.3,-88.7,54.7,-84.1,54.9,-76.9Z" transform="translate(100 100)" />
        </svg>
    </div>
    
    <!-- Wave background at bottom -->
    <div class="position-absolute bottom-0 start-0 w-100" style="z-index: 1;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 180">
            <path fill="#f9fafb" fill-opacity="1" d="M0,160L48,149.3C96,139,192,117,288,117.3C384,117,480,139,576,149.3C672,160,768,160,864,144C960,128,1056,96,1152,85.3C1248,75,1344,85,1392,90.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
        </svg>
    </div>
    
    <div class="container position-relative" style="z-index: 2;">
        <div class="row py-5">
            <!-- Full width hero banner section -->
            <div class="col-12 mb-4" data-aos="fade-up" style="padding-left: 0; padding-right: 0;">
                <!-- Hero Banner Container -->
                <div class="hero-banner-container" id="hero-banner">
                    {% if hero_banner_data and hero_banner_data.slides %}
                        <!-- Server-side rendered banner for instant loading -->
                        {% set slide = hero_banner_data.slides[0] %}
                        <div class="banner-slider" style="position: relative; height: 300px; border-radius: 0; overflow: hidden;">
                            <div class="slide active" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;">
                                <a href="{{ slide.redirect_url or '#' }}" class="banner-link" data-slide-id="{{ slide.id }}">
                                    <div class="slide-content" style="
                                        background-image: url('{{ slide.image_url }}');
                                        background-size: cover;
                                        background-position: center;
                                        background-repeat: no-repeat;
                                        height: 100%;
                                        width: 100%;
                                        border-radius: 0;
                                    "></div>
                                </a>
                            </div>
                        </div>
                        
                        <!-- Preload mobile image for instant switching -->
                        {% if slide.mobile_image_url %}
                        <link rel="preload" as="image" href="{{ slide.mobile_image_url }}" media="(max-width: 768px)">
                        {% endif %}
                        
                        <!-- Preload desktop image -->
                        <link rel="preload" as="image" href="{{ slide.image_url }}">
                    {% else %}
                        <!-- Fallback: JavaScript loading for when server-side data is unavailable -->
                        <div class="banner-loader" style="display: none;">
                            <div class="text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading banner...</span>
                                </div>
                            </div>
                        </div>
                        <!-- Banner content will be loaded here by JavaScript -->
                    {% endif %}
                </div>
            </div>
            <!-- Search Section -->
            <div class="col-12 mb-1" data-aos="fade-up" data-aos-delay="600" style="position: relative; z-index: 10;">
                <div class="hero-search-section" style="background-color: #f1f3fc; padding: 25px; border-radius: 15px; margin-bottom: 0; margin-top: -100px; position: relative; z-index: 10;">
                <!-- Search bar with tabs -->
                <div class="position-relative mb-2 hero-search-container">
                    <div class="card border-0 shadow-sm rounded-4" style="background-color: #fffcfc;">
                        <div class="card-body px-3 py-3">
                            <!-- Search Tabs - Horizontal Slider -->
                            <div class="hero-tabs-slider-container mb-2">
                                <ul class="nav nav-tabs border-0 hero-tabs-slider" id="searchTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active hero-search-tab" id="treatments-tab" data-bs-toggle="tab" data-bs-target="#treatments-search" type="button" role="tab" aria-controls="treatments-search" aria-selected="true">Treatments</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link hero-search-tab" id="doctors-tab" data-bs-toggle="tab" data-bs-target="#doctors-search" type="button" role="tab" aria-controls="doctors-search" aria-selected="false">Doctor</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link hero-search-tab" id="procedures-tab" data-bs-toggle="tab" data-bs-target="#procedures-search" type="button" role="tab" aria-controls="procedures-search" aria-selected="false">Procedures</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link hero-search-tab" id="discussions-tab" data-bs-toggle="tab" data-bs-target="#discussions-search" type="button" role="tab" aria-controls="discussions-search" aria-selected="false">Discussions</button>
                                    </li>


                                </ul>
                            </div>
                            
                            <!-- Tab Content -->
                            <div class="tab-content" id="searchTabsContent">
                                <!-- Treatments Search Tab -->
                                <div class="tab-pane fade show active" id="treatments-search" role="tabpanel" aria-labelledby="treatments-tab">
                                    <form action="{{ url_for('web.search') }}" method="get">
                                        <input type="hidden" name="type" value="packages">
                                        <div class="row g-2">
                                            <div class="col-12 col-lg-7">
                                                <div class="position-relative">
                                                    <input type="text" class="form-control hero-search-input w-100" id="packageSearch" name="q" placeholder="Hair transplant package, dental packages, etc." autocomplete="off">
                                                    <span class="position-absolute top-50 end-0 translate-middle-y pe-2">
                                                        <i class="fas fa-search text-muted hero-search-icon"></i>
                                                    </span>
                                                    <!-- Suggestions Dropdown (positioned absolutely) -->
                                                    <div class="dropdown-menu w-100 shadow-sm" id="packageSuggestions" style="display: none; position: absolute; z-index: 1050;"></div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-3">
                                                <div class="position-relative">
                                                    <input type="text" class="form-control hero-search-input w-100" id="packageLocationSearch" name="location" placeholder="Mumbai, Delhi, etc." autocomplete="off">
                                                    <span class="position-absolute top-50 end-0 translate-middle-y pe-2">
                                                        <i class="fas fa-map-marker-alt text-muted hero-search-icon"></i>
                                                    </span>
                                                    <!-- City Suggestions Dropdown -->
                                                    <div class="dropdown-menu w-100 shadow-sm" id="packageLocationSuggestions" style="display: none; position: absolute; z-index: 1050;"></div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-2">
                                                <button type="submit" class="btn btn-primary hero-search-btn w-100">Search</button>
                                            </div>
                                        </div>
                                    </form>

                                </div>
                                
                                <!-- Doctors Search Tab -->
                                <div class="tab-pane fade" id="doctors-search" role="tabpanel" aria-labelledby="doctors-tab">
                                    <form action="{{ url_for('web.search') }}" method="get">
                                        <input type="hidden" name="type" value="doctors">
                                        <div class="row g-2">
                                            <div class="col-12 col-lg-7">
                                                <div class="position-relative">
                                                    <input type="text" class="form-control hero-search-input w-100" id="doctorSearch" name="q" placeholder="Rhinoplasty, liposuction, etc." autocomplete="off">
                                                    <span class="position-absolute top-50 end-0 translate-middle-y pe-2">
                                                        <i class="fas fa-search text-muted hero-search-icon"></i>
                                                    </span>
                                                    <!-- Suggestions Dropdown (positioned absolutely) -->
                                                    <div class="dropdown-menu w-100 shadow-sm" id="doctorSuggestions" style="display: none; position: absolute; z-index: 1050;"></div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-3">
                                                <div class="position-relative">
                                                    <input type="text" class="form-control hero-search-input w-100" id="locationSearch" name="location" placeholder="Mumbai, Delhi, etc." autocomplete="off">
                                                    <span class="position-absolute top-50 end-0 translate-middle-y pe-2">
                                                        <i class="fas fa-map-marker-alt text-muted hero-search-icon"></i>
                                                    </span>
                                                    <!-- City Suggestions Dropdown -->
                                                    <div class="dropdown-menu w-100 shadow-sm" id="locationSuggestions" style="display: none; position: absolute; z-index: 1050;"></div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-2">
                                                <button type="submit" class="btn btn-primary hero-search-btn w-100">Search</button>
                                            </div>
                                        </div>
                                    </form>

                                </div>
                                
                                <!-- Procedures Search Tab -->
                                <div class="tab-pane fade" id="procedures-search" role="tabpanel" aria-labelledby="procedures-tab">
                                    <form action="{{ url_for('web.search') }}" method="get">
                                        <input type="hidden" name="type" value="procedures">
                                        <div class="row g-2">
                                            <div class="col-12 col-lg-10">
                                                <div class="position-relative">
                                                    <input type="text" class="form-control hero-search-input w-100" id="procedureSearch" name="q" placeholder="Rhinoplasty, botox, etc." autocomplete="off">
                                                    <span class="position-absolute top-50 end-0 translate-middle-y pe-2">
                                                        <i class="fas fa-search text-muted hero-search-icon"></i>
                                                    </span>
                                                    <!-- Suggestions Dropdown (positioned absolutely) -->
                                                    <div class="dropdown-menu w-100 shadow-sm" id="procedureSuggestions" style="display: none; position: absolute; z-index: 1050;"></div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-2">
                                                <button type="submit" class="btn btn-primary hero-search-btn w-100">Find Procedures</button>
                                            </div>
                                        </div>
                                    </form>

                                </div>
                                
                                <!-- Discussions Search Tab -->
                                <div class="tab-pane fade" id="discussions-search" role="tabpanel" aria-labelledby="discussions-tab">
                                    <form action="{{ url_for('web.search') }}" method="get">
                                        <input type="hidden" name="type" value="threads">
                                        <div class="row g-2">
                                            <div class="col-12 col-lg-10">
                                                <div class="position-relative">
                                                    <input type="text" class="form-control hero-search-input w-100" id="discussionSearch" name="q" placeholder="Recovery time, experiences, etc." autocomplete="off">
                                                    <span class="position-absolute top-50 end-0 translate-middle-y pe-2">
                                                        <i class="fas fa-search text-muted hero-search-icon"></i>
                                                    </span>
                                                    <!-- Suggestions Dropdown (positioned absolutely) -->
                                                    <div class="dropdown-menu w-100 shadow-sm" id="discussionSuggestions" style="display: none; position: absolute; z-index: 1050;"></div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-lg-2">
                                                <button type="submit" class="btn btn-primary hero-search-btn w-100">Find Discussions</button>
                                            </div>
                                        </div>
                                    </form>

                                </div>

                            </div>
                        </div>
                    </div>
                    
                    <!-- Confused? Ask AI Section - Separate from tabs -->
                    <div class="mt-4">
                        <div class="card border-0" style="background: white; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                            <div class="card-body p-4">
                                <div class="mb-3">
                                    <span class="hero-search-tab-text" style="color: #00A0B0; font-size: 16px;">
                                        Confused? Ask AI for treatment recommendations
                                    </span>
                                </div>
                                <form action="/ai-recommendations" method="post" id="aiRecommendationForm">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                    <input type="hidden" name="concerns" id="hiddenConcerns" value=""/>
                                    <!-- Desktop Layout -->
                                    <div class="row g-2 d-none d-lg-flex">
                                        <div class="col-lg-10">
                                            <textarea class="form-control hero-search-input ai-concerns-textarea" id="aiConcernsDesktop"
                                                     placeholder="e.g., 'I have severe acne scars on both cheeks from teenage years and want to know which laser treatment would work best' or 'My nose bridge is too wide and I'm considering rhinoplasty but worried about recovery time and natural results'" 
                                                     rows="2" style="resize: none; background-color: #f8f9fa; border-radius: 12px; padding: 12px 16px; font-size: 15px;"></textarea>
                                        </div>
                                        <div class="col-lg-2">
                                            <button type="submit" class="btn w-100 h-100" style="background-color: #00A0B0; border: none; border-radius: 12px; color: white; font-weight: 600; font-size: 15px;">
                                                <i class="fas fa-magic me-1"></i>Ask AI
                                            </button>
                                        </div>
                                    </div>
                                    <!-- Mobile Layout -->
                                    <div class="d-block d-lg-none">
                                        <div class="row g-2">
                                            <div class="col-8">
                                                <textarea class="form-control hero-search-input ai-concerns-textarea" id="aiConcernsMobile"
                                                         placeholder="e.g., 'I have deep wrinkles around my eyes and mouth from smiling, what non-surgical options can make me look 10 years younger?' or 'My double chin makes me look heavier than I am, which treatment would give fastest results without surgery?'" 
                                                         rows="3" style="resize: none; background-color: #f8f9fa; border-radius: 12px; padding: 12px 16px; font-size: 15px;"></textarea>
                                            </div>
                                            <div class="col-4">
                                                <button type="submit" class="btn w-100 h-100" style="background-color: #00A0B0; border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 14px; padding: 8px 4px;">
                                                    <i class="fas fa-magic me-1"></i>Ask AI
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                        <!-- Explore procedures and find specialists buttons removed as requested -->
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Full width image below hero section (visible only on desktop) -->
<div class="container px-0 mb-5 d-none d-md-block">
    <div class="row g-0 justify-content-center">
        <div class="col-md-8">
            <img src="{{ url_for('static', filename='images/hero_bottom_image.jpg') }}" 
                 alt="Antidote Healthcare" 
                 class="img-fluid w-100" 
                 style="max-height: 210px; object-fit: contain; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        </div>
    </div>
</div>




{% if error %}
<div class="alert alert-danger" role="alert">
    {{ error }}
</div>
{% endif %}

<!-- Personalized AI Recommendations Section (HIDDEN - needs significant development work) -->
<!-- 
{% if ai_recommendations %}
<section class="py-4 position-relative" style="background-color: #f8f9ff;">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="card border-0 shadow-lg" style="border-radius: 20px; background: rgba(255,255,255,0.95);">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center mb-3">
                            <i class="fas fa-robot text-primary me-3" style="font-size: 1.5rem;"></i>
                            <div>
                                <h4 class="mb-1 fw-bold">Personalized AI Recommendations</h4>
                                <p class="text-muted mb-0">{{ ai_recommendations.message }}</p>
                            </div>
                        </div>
                        <div class="d-flex flex-wrap gap-2">
                            {% for category in ai_recommendations.suggested_categories %}
                            <a href="{{ url_for('web.procedures', category_name=category) }}" 
                               class="btn btn-primary btn-sm rounded-pill">
                                <i class="fas fa-star me-1"></i>{{ category }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}
-->

<!-- Featured Treatment Packages Section -->
{% if featured_packages %}
<section class="py-3 position-relative featured-packages-section" style="background-color: #f8f9ff;">
    <div class="container">
        <div class="section-card">
            <div class="row mb-4">
                <div class="col-md-8">
                    <h2 class="section-title fw-bold mb-3" data-aos="fade-up">
                        <i class="fas fa-gift text-primary me-2"></i>Featured Treatment <span class="text-gradient">Packages</span>
                    </h2>
                    <p class="lead text-muted mb-0" data-aos="fade-up" data-aos-delay="100">
                        Comprehensive treatment packages from verified clinics
                    </p>
                </div>
                <div class="col-md-4 text-md-end d-flex align-items-center justify-content-md-end">
                    <a href="{{ url_for('web.procedures') }}" class="btn btn-outline-primary" data-aos="fade-up">
                        View All Packages <i class="fas fa-arrow-right ms-2"></i>
                    </a>
                </div>
            </div>
            
            <div class="packages-carousel">
                {% for package in featured_packages %}
                <div class="package-item" onclick="window.location.href='{{ url_for('enhanced_package.package_detail', slug=package.slug) }}'">
                    <!-- Package Header with Title and Price -->
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1">
                            <h5 class="package-title mb-1">{{ package.title }}
                                {# Display actual treatment name in brackets for clarity #}
                                {% if package.actual_treatment_name %}
                                    <span class="text-muted" style="font-weight: 400; font-size: 0.9em;">
                                        ({{ package.actual_treatment_name }})
                                    </span>
                                {% endif %}
                            </h5>
                            <h6 class="text-primary mb-0">{{ package.clinic_name }}</h6>
                        </div>
                        <div class="pricing-section text-end ms-3">
                            {% if package.price_discounted %}
                            <div class="text-muted text-decoration-line-through small">₹{{ "{:,.0f}".format(package.price_actual) }}</div>
                            <div class="h5 text-primary fw-bold mb-1">₹{{ "{:,.0f}".format(package.price_discounted) }}</div>
                            <span class="badge bg-success small">{{ package.discount_percentage }}% OFF</span>
                            {% else %}
                            <div class="h5 text-primary fw-bold">₹{{ "{:,.0f}".format(package.price_actual) }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Package Description -->
                    <p class="package-description text-muted small mb-3">
                        {% if package.description %}
                            {{ package.description[:120] }}{% if package.description|length > 120 %}...{% endif %}
                        {% else %}
                            Comprehensive treatment package with expert care and personalized attention.
                        {% endif %}
                    </p>
                    
                    <!-- Results Section - Before/After Photos -->
                    {% if package.results_gallery and package.results_gallery|length > 0 %}
                    <div class="results-section">
                        <h6 class="mb-2 fw-bold text-dark small">{{ package.results_gallery|length }} Result{{ 's' if package.results_gallery|length > 1 else '' }}</h6>
                        <div class="results-mini-gallery d-flex gap-2 overflow-hidden">
                            {% for result in package.results_gallery[:2] %}
                            <div class="result-mini-item d-flex gap-1" style="min-width: 140px;">
                                {% if result.before_image %}
                                <div class="before-image position-relative" style="width: 65px; height: 65px;">
                                    <img src="{{ result.before_image }}" alt="Before" 
                                         class="img-fluid rounded shadow-sm" 
                                         style="width: 100%; height: 100%; object-fit: cover;"
                                         onerror="this.parentElement.style.display='none';">
                                    <div class="position-absolute bottom-0 start-0 end-0 bg-dark text-white text-center" 
                                         style="font-size: 0.55rem; font-weight: 600; padding: 1px; border-radius: 0 0 4px 4px;">BEFORE</div>
                                </div>
                                {% endif %}
                                {% if result.after_image %}
                                <div class="after-image position-relative" style="width: 65px; height: 65px;">
                                    <img src="{{ result.after_image }}" alt="After" 
                                         class="img-fluid rounded shadow-sm"
                                         style="width: 100%; height: 100%; object-fit: cover;"
                                         onerror="this.parentElement.style.display='none';">
                                    <div class="position-absolute bottom-0 start-0 end-0 bg-dark text-white text-center" 
                                         style="font-size: 0.55rem; font-weight: 600; padding: 1px; border-radius: 0 0 4px 4px;">AFTER</div>
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                            {% if package.results_gallery|length > 2 %}
                            <div class="d-flex align-items-center justify-content-center text-muted small">
                                +{{ package.results_gallery|length - 2 }} more
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endif %}


<!-- Category Sections -->
{% if category_packages %}
{% for category, packages in category_packages.items() %}
{% if packages %}
<section class="py-3 position-relative" style="background-color: #f8f9ff;">
    <div class="container">
        <div class="section-card">
            <div class="row mb-4">
                <div class="col-md-8">
                    <h2 class="section-title fw-bold mb-3" data-aos="fade-up">
                        {{ category }}
                    </h2>
                    <p class="lead text-muted mb-0" data-aos="fade-up" data-aos-delay="100">
                        {% if 'Injectable' in category %}Expert anti-aging and enhancement injections with natural-looking results
                        {% elif 'Facial' in category %}Professional facial treatments for radiant, healthy skin
                        {% elif 'Laser' in category %}Advanced laser technology for skin renewal and rejuvenation
                        {% elif 'Hair' in category %}Comprehensive hair restoration and transplant solutions
                        {% elif 'Surgical' in category %}Expert surgical procedures for enhanced appearance and confidence
                        {% elif 'Body' in category %}Specialized body contouring and enhancement treatments
                        {% elif 'Medical' in category %}Professional medical consultations and assessments
                        {% elif 'Brows & Eyes' in category %}Expert eyebrow shaping, microblading, and eye enhancement treatments
                        {% elif 'Lips & Smile' in category %}Professional lip fillers, enhancements, and smile makeover treatments
                        {% else %}Specialized treatments tailored to your unique needs
                        {% endif %}
                    </p>
                </div>
                <div class="col-md-4 text-md-end d-flex align-items-center justify-content-md-end">
                    <a href="{{ url_for('enhanced_package.package_directory') }}?category={{ category }}" class="btn btn-outline-primary" data-aos="fade-up" onclick="window.location.href='{{ url_for('enhanced_package.package_directory') }}?category={{ category|urlencode }}'; return false;">
                        View All {{ category }} <i class="fas fa-arrow-right ms-2"></i>
                    </a>
                </div>
            </div>
            
            <div class="packages-carousel">
                {% for package in packages[:6] %}
                <div class="package-item" onclick="window.location.href='{{ url_for('enhanced_package.package_detail', slug=package.slug) }}'">
                    <!-- Package Header with Title and Price -->
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1">
                            <h5 class="package-title mb-1">{{ package.title }}
                                {# Display actual treatment name in brackets for clarity #}
                                {% if package.actual_treatment_name %}
                                    <span class="text-muted" style="font-weight: 400; font-size: 0.9em;">
                                        ({{ package.actual_treatment_name }})
                                    </span>
                                {% endif %}
                            </h5>
                            <h6 class="text-primary mb-0">{{ package.clinic_name }}</h6>
                        </div>
                        <div class="pricing-section text-end ms-3">
                            {% if package.price_discounted %}
                            <div class="text-muted text-decoration-line-through small">₹{{ "{:,.0f}".format(package.price_actual) }}</div>
                            <div class="h5 text-primary fw-bold mb-1">₹{{ "{:,.0f}".format(package.price_discounted) }}</div>
                            <span class="badge bg-success small">{{ ((package.price_actual - package.price_discounted) / package.price_actual * 100)|round|int }}% OFF</span>
                            {% else %}
                            <div class="h5 text-primary fw-bold">₹{{ "{:,.0f}".format(package.price_actual) }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Package Description -->
                    <p class="package-description text-muted small mb-3">
                        {% if package.description %}
                            {{ package.description[:120] }}{% if package.description|length > 120 %}...{% endif %}
                        {% else %}
                            Professional {{ category.lower() }} treatment with personalized care and expert attention.
                        {% endif %}
                    </p>
                    
                    <!-- Treatment Details -->
                    {% if package.duration or package.downtime %}
                    <div class="treatment-details mb-2">
                        {% if package.duration %}
                        <small class="text-muted me-3">
                            <i class="fas fa-clock me-1"></i>{{ package.duration }}
                        </small>
                        {% endif %}
                        {% if package.downtime %}
                        <small class="text-muted">
                            <i class="fas fa-calendar-days me-1"></i>{{ package.downtime }}
                        </small>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
                
                <!-- Arrow button as 7th item if there are more packages -->
                {% if packages|length >= 7 %}
                <div class="package-item d-flex align-items-center justify-content-center" onclick="window.location.href='{{ url_for('enhanced_package.package_directory') }}?category={{ category|urlencode }}'" style="cursor: pointer; min-height: 120px; background: linear-gradient(135deg, #f8f9ff 0%, #e3f2fd 100%); border: 2px dashed #007bff; border-radius: 12px;">
                    <div class="text-center">
                        <div class="arrow-icon mb-2" style="font-size: 2rem; color: #007bff;">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                        <h6 class="text-primary mb-0 fw-semibold">View All</h6>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endif %}
{% endfor %}
{% endif %}

<!-- High-Review Clinics Section -->
<section class="py-3 position-relative" style="background-color: #f8f9ff;">
    <div class="container">
        <div class="section-card">
            <div class="row mb-4">
                <div class="col-md-8">
                    <h2 class="section-title fw-bold mb-3" data-aos="fade-up">
                        Clinics with <span class="text-gradient">1000+ Reviews</span>
                    </h2>
                    <p class="lead text-muted mb-0" data-aos="fade-up" data-aos-delay="100">
                        Top-rated clinics with extensive patient feedback and proven track records
                    </p>
                </div>
                <div class="col-md-4 text-md-end d-flex align-items-center justify-content-md-end">
                    <a href="{{ url_for('clinic.all_clinics') }}" class="btn btn-outline-primary" data-aos="fade-up" onclick="window.location.href='{{ url_for('clinic.all_clinics') }}'; return false;">
                        View All High-Review Clinics <i class="fas fa-arrow-right ms-2"></i>
                    </a>
                </div>
            </div>
            
            <div class="clinics-carousel">
                {% set high_review_clinics = verified_clinics|selectattr('google_review_count', 'greaterthan', 999)|list %}
                {% if high_review_clinics %}
                    {% for clinic in high_review_clinics %}
                    <div class="clinic-slider-item" onclick="window.location.href='/clinic/view/{{ clinic.slug or clinic.id }}'">
                        <!-- Clinic Header with Name -->
                        <div class="mb-3">
                            <h5 class="clinic-title mb-1">{{ clinic.name }}</h5>
                            
                            <!-- Rating Display -->
                            {% if clinic.google_rating %}
                            <div class="d-flex align-items-center mb-2">
                                <div class="stars me-2">
                                    {% for i in range(5) %}
                                        {% if i < clinic.google_rating|round %}
                                            <i class="fas fa-star" style="color: #ffc107; font-size: 1rem;"></i>
                                        {% else %}
                                            <i class="far fa-star" style="color: #dee2e6; font-size: 1rem;"></i>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <span class="fw-bold text-warning" style="font-size: 1rem;">{{ "%.1f"|format(clinic.google_rating) }} ⭐</span>
                            </div>
                            
                            <!-- Google Reviews Count with special highlighting -->
                            <div class="mb-2">
                                <i class="fab fa-google me-1" style="color: #4285f4; font-size: 0.8rem;"></i>
                                <span class="text-warning fw-bold" style="font-size: 0.85rem;">{{ "{:,.0f}".format(clinic.google_review_count) }} reviews</span>
                            </div>
                            {% endif %}
                            
                            <h6 class="text-primary mb-0">{{ clinic.city }}{{ ', ' + clinic.state if clinic.state else '' }}</h6>
                        </div>
                        
                        <!-- Clinic Description -->
                        {% if clinic.description %}
                        <p class="clinic-description text-muted small mb-3">
                            {{ clinic.description[:100] }}{% if clinic.description|length > 100 %}...{% endif %}
                        </p>
                        {% else %}
                        <p class="clinic-description text-muted small mb-3">
                            Highly rated medical aesthetic center with extensive patient satisfaction records.
                        </p>
                        {% endif %}
                        
                        <!-- Clinic Stats -->
                        <div class="clinic-stats-row d-flex justify-content-between align-items-center mb-3">
                            {% if clinic.package_count %}
                            <div class="text-muted small">
                                <i class="fas fa-box me-1"></i>{{ clinic.package_count }} packages
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info w-100">
                        <i class="fas fa-info-circle me-2"></i> No clinics with 1000+ reviews available yet.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Real-time Social Proof Section -->
{% if recent_activity %}
<section class="py-3" style="background-color: #f8f9ff; border-top: 1px solid #f0f0f0; border-bottom: 1px solid #f0f0f0;">
    <div class="container">
        <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <i class="fas fa-pulse text-success me-2"></i>
                <span class="fw-medium">Live Activity:</span>
            </div>
            <div class="activity-ticker">
                {% for activity in recent_activity[:3] %}
                <span class="activity-item me-4">{{ activity.message }}</span>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Procedure Categories Section -->
<section class="py-2 position-relative">
    <div class="position-absolute top-0 start-0" style="z-index: -1; opacity: 0.03;">
        <svg width="600" height="400" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
            <path fill="#3FAFB5" d="M42.7,-57.8C53.9,-49.4,61.1,-35.4,62.9,-21.6C64.7,-7.9,61.1,5.7,56.7,19.2C52.3,32.7,47,46.1,37.1,52.4C27.2,58.8,13.6,58.1,-0.6,58.9C-14.9,59.7,-29.8,62,-41.8,56.1C-53.8,50.2,-63,36,-68.5,20.1C-74,4.2,-75.9,-13.3,-69.5,-27C-63.1,-40.6,-48.3,-50.3,-34,-56.1C-19.6,-61.9,-5.7,-63.8,7.9,-73.5C21.5,-83.2,43,-83.7,42.7,-57.8Z" transform="translate(100 100)" />
        </svg>
    </div>

    <div class="container">
        <div class="section-card">
            <div class="row mb-4">
                <div class="col-md-8">
                    <h2 class="section-title fw-bold mb-3" data-aos="fade-up">
                        Explore Procedures by <span class="text-gradient">Categories</span>
                    </h2>
                    <p class="lead text-muted mb-0" data-aos="fade-up" data-aos-delay="100">
                        Browse our comprehensive range of aesthetic procedures organized by treatment areas
                    </p>
                </div>
                <div class="col-md-4 text-md-end d-flex align-items-center justify-content-md-end">
                    <a href="{{ url_for('web.categories') }}" class="btn btn-outline-primary" data-aos="fade-up">
                        View All Categories <i class="fas fa-arrow-right ms-2"></i>
                    </a>
                </div>
            </div>
            
            <div class="categories-carousel">
                {% if procedure_categories %}
                    {% for category in procedure_categories %}
                        {% set category_class = category.name|lower %}
                        {% if 'rhinoplasty' in category_class or 'nose' in category_class %}
                            {% set icon_class = 'fa-nose' %}
                        {% elif 'facelift' in category_class or 'face' in category_class %}
                            {% set icon_class = 'fa-user' %}
                        {% elif 'hair' in category_class %}
                            {% set icon_class = 'fa-cut' %}
                        {% elif 'liposuction' in category_class or 'body' in category_class %}
                            {% set icon_class = 'fa-weight' %}
                        {% elif 'scar' in category_class or 'skin' in category_class %}
                            {% set icon_class = 'fa-allergies' %}
                        {% else %}
                            {% set icon_class = 'fa-hospital' %}
                        {% endif %}
                        
                        <div class="category-slider-item" onclick="window.location.href='{{ url_for('enhanced_package.package_directory', category_id=category.id) }}'"
                             data-category-id="{{ category.id }}" 
                             data-category-name="{{ category.name }}"
                             data-body-part="{{ category.body_part.name if category.body_part else '' }}">
                            <div class="category-icon-wrapper">
                                {% if category.image_url %}
                                    <img src="{{ category.image_url }}" 
                                         alt="{{ category.name }}" 
                                         class="category-image category-image-optimized" 
                                         loading="lazy"
                                         onerror="this.src='/static/images/categories/default-procedure.jpg'">
                                {% else %}
                                    <div class="category-icon bg-primary bg-opacity-10 d-flex align-items-center justify-content-center mx-auto rounded">
                                        <i class="fas {{ icon_class }} text-primary" style="font-size: 2rem;"></i>
                                    </div>
                                {% endif %}
                            </div>
                            <h5 class="category-title mb-2">{{ category.name|title }}</h5>
                            <div class="procedure-count mb-3">
                                <small class="text-primary fw-semibold">{{ category.package_count or 0 }} packages</small>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info w-100">
                        <i class="fas fa-info-circle me-2"></i> No procedure categories available yet. Check back soon for updates.
                    </div>
                {% endif %}
            </div>
        </div>
        
    </div>
</section>

<!-- Popular Procedures Section -->
<section class="py-2 position-relative" style="background-color: #f8f9ff;">
    <div class="container">
        <div class="section-card">
            <div class="row mb-4">
                <div class="col-md-8">
                    <h2 class="section-title fw-bold mb-3" data-aos="fade-up">
                        Popular <span class="text-gradient">Procedures</span>
                    </h2>
                    <p class="lead text-muted mb-0" data-aos="fade-up" data-aos-delay="100">
                        Explore highly sought-after cosmetic and medical procedures
                    </p>
                </div>
                <div class="col-md-4 text-md-end d-flex align-items-center justify-content-md-end">
                    <a href="{{ url_for('web.procedures') }}" class="btn btn-outline-primary" data-aos="fade-up">
                        View All Procedures <i class="fas fa-arrow-right ms-2"></i>
                    </a>
                </div>
            </div>
            
            <div class="procedures-carousel">
                {% if popular_procedures %}
                    {% for procedure in popular_procedures %}
                    <div class="procedure-slider-item" onclick="window.location.href='{{ url_for('web.procedure_detail', procedure_id=procedure.id) }}'">
                        <div class="procedure-header mb-3">
                            <div class="procedure-badges d-flex gap-2">
                                <span class="badge bg-primary rounded-pill px-3 py-1">Popular</span>
                            </div>
                        </div>
                        
                        <div class="procedure-content">
                            <h5 class="procedure-title fw-bold mb-3">{{ procedure.procedure_name }}</h5>
                            <p class="procedure-description text-muted mb-3">
                                {% if procedure.short_description %}
                                    {% if procedure.short_description|length > 65 %}
                                        {{ procedure.short_description[:65].rsplit(' ', 1)[0] }}...
                                    {% else %}
                                        {{ procedure.short_description }}
                                    {% endif %}
                                {% else %}
                                    Professional {{ procedure.procedure_name.lower() }} treatment with expert care and proven results.
                                {% endif %}
                            </p>
                            
                            <div class="procedure-details">
                                <div class="detail-item d-flex align-items-center mb-2">
                                    <i class="fas fa-rupee-sign text-success me-2"></i>
                                    <span class="detail-text">₹{{ "{:,.0f}".format(procedure.min_cost|default(15000)) }} - ₹{{ "{:,.0f}".format(procedure.max_cost|default(150000)) }}</span>
                                </div>
                                <div class="detail-item d-flex align-items-center">
                                    <i class="fas fa-clock text-primary me-2"></i>
                                    <span class="detail-text">{{ procedure.recovery_time|default('2-5 days') }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info w-100">
                        <i class="fas fa-info-circle me-2"></i> No procedures available yet.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>


<!-- Community Section -->
<section class="py-3 position-relative overflow-hidden" style="background-color: #f8f9ff;">
    <!-- Decorative elements -->
    <div class="position-absolute bottom-0 end-0" style="z-index: -1; opacity: 0.1;">
        <svg width="300" height="300" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
            <path fill="#DEDEDE" d="M46.5,-45.5C57.1,-30.5,60.8,-11.9,59.1,6.8C57.3,25.5,50.1,44.2,36.4,53.8C22.7,63.4,2.5,63.8,-17.7,59.1C-38,54.4,-58.4,44.6,-67,27.8C-75.6,11,-72.4,-12.8,-61.8,-30.8C-51.2,-48.8,-33.2,-61.1,-14.2,-62.7C4.9,-64.4,35.9,-60.4,46.5,-45.5Z" transform="translate(100 100)" />
        </svg>
    </div>
    
    <div class="container">
        <div class="section-card">
            <div class="row mb-4">
                <div class="col-md-8">
                    <h2 class="section-title fw-bold mb-3" data-aos="fade-up">
                        Join Our Support <span class="text-gradient">Community</span>
                    </h2>
                    <p class="lead text-muted mb-0" data-aos="fade-up" data-aos-delay="100">
                        Connect with patients and doctors, share experiences, and find support throughout your healthcare journey
                    </p>
                </div>
                <div class="col-md-4 text-md-end d-flex align-items-center justify-content-md-end">
                    <a href="{{ url_for('web.community') }}" class="btn btn-outline-primary" data-aos="fade-up">
                        View Community <i class="fas fa-arrow-right ms-2"></i>
                    </a>
                </div>
            </div>
            
            <div class="row justify-content-center">
                <div class="col-12" data-aos="fade-up">
                    <div class="row g-4">
                    {% if recent_threads %}
                        <!-- Featured discussion -->
                        <div class="col-12 mb-4">
                            <div class="card shadow-hover h-100 position-relative">
                                <div class="card-body p-4">
                                    <div class="badge-pill bg-secondary bg-opacity-10 text-secondary px-3 py-1 position-absolute top-0 end-0 mt-3 me-3">
                                        <i class="fas fa-star me-1"></i> Featured
                                    </div>
                                    
                                    <div class="d-flex align-items-center mb-3">
                                        <div>
                                            <div class="d-flex align-items-center">
                                                <h6 class="mb-0">{{ recent_threads[0].author_name|default('Anonymous User') }}</h6>
                                                {% if recent_threads[0].is_anonymous %}
                                                    <span class="badge bg-secondary ms-2 small">Anonymous</span>
                                                {% endif %}
                                            </div>
                                            <p class="text-muted small mb-0">
                                                {% if recent_threads[0].created_at %}
                                                    {% if recent_threads[0].created_at is string %}
                                                        {{ recent_threads[0].created_at[:10] }}
                                                    {% else %}
                                                        {{ recent_threads[0].created_at.strftime('%b %d, %Y') }}
                                                    {% endif %}
                                                {% else %}
                                                    May 01, 2025
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <h5 class="card-title mb-3">{{ recent_threads[0].title }}</h5>
                                    <p class="card-text text-muted">{{ recent_threads[0].content|truncate(180) }}</p>
                                    
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <span class="text-muted small me-3"><i class="fas fa-eye me-1"></i> {{ recent_threads[0].view_count|default(0) }} views</span>
                                            <span class="text-muted small"><i class="fas fa-comment-alt me-1"></i> {{ recent_threads[0].reply_count|default(0) }} replies</span>
                                        </div>
                                        <a href="{{ url_for('web.community_thread_detail', thread_id=recent_threads[0].id) }}" class="btn btn-outline-primary btn-sm">
                                            Read More <i class="fas fa-arrow-right ms-1"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent discussions -->
                        {% for thread in recent_threads %}
                            {% if loop.index > 1 and loop.index <= 5 %}
                                <div class="col-lg-4 col-md-6">
                                    <div class="card shadow-hover h-100">
                                        <div class="card-body p-4">
                                            {% if loop.index == 2 %}
                                                <div class="badge-pill bg-secondary bg-opacity-10 text-secondary px-3 py-1 position-absolute top-0 end-0 mt-3 me-3">
                                                    <i class="fas fa-star me-1"></i> Featured
                                                </div>
                                            {% endif %}
                                            
                                            <div class="d-flex align-items-center mb-3">
                                                <div>
                                                    <div class="d-flex align-items-center">
                                                        <h6 class="mb-0">{{ thread.author_name|default('Anonymous User') }}</h6>
                                                        {% if thread.is_anonymous %}
                                                            <span class="badge bg-secondary ms-2 small">Anonymous</span>
                                                        {% endif %}
                                                    </div>
                                                    <p class="text-muted small mb-0">
                                                        {% if thread.created_at %}
                                                            {% if thread.created_at is string %}
                                                                {{ thread.created_at[:10] }}
                                                            {% else %}
                                                                {{ thread.created_at.strftime('%Y-%m-%d') }}
                                                            {% endif %}
                                                        {% else %}
                                                            2025-05-20
                                                        {% endif %}
                                                    </p>
                                                </div>
                                            </div>
                                            
                                            <h5 class="card-title mb-3">{{ thread.title }}</h5>
                                            <p class="card-text text-muted">{{ thread.content|truncate(120) }}</p>
                                            
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <span class="text-muted small me-3"><i class="fas fa-eye me-1"></i> {{ thread.view_count|default(0) }} views</span>
                                                    <span class="text-muted small"><i class="fas fa-comment-alt me-1"></i> {{ thread.reply_count|default(0) }} replies</span>
                                                </div>
                                                <a href="{{ url_for('web.community_thread_detail', thread_id=thread.id) }}" class="btn btn-outline-primary btn-sm">
                                                    Read More <i class="fas fa-arrow-right ms-1"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                        
                        <div class="col-12 text-center mt-3" data-aos="fade-up" data-aos-delay="300">
                            <a href="{{ url_for('web.community') }}" class="btn btn-link">
                                View All Discussions <i class="fas fa-arrow-right ms-1"></i>
                            </a>
                        </div>
                    {% else %}
                        <div class="col-12">
                            <div class="card shadow-lg">
                                <div class="card-body p-5 text-center">
                                    <div class="display-4 text-muted mb-3">
                                        <i class="fas fa-comments"></i>
                                    </div>
                                    <h4 class="mb-3">Join the Conversation</h4>
                                    <p class="text-muted mb-4">Be the first to start a discussion in our community. Share your experience, ask questions, and connect with others.</p>
                                    <a href="{{ url_for('web.community') }}" class="btn btn-primary">
                                        <i class="fas fa-plus-circle me-2"></i> Create First Thread
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Consultation Modals for Each Doctor -->
{% if top_doctors %}
    {% for doctor in top_doctors %}
    <div class="modal fade" id="bookConsultationModal{{ doctor.id }}" tabindex="-1" aria-labelledby="bookConsultationModalLabel{{ doctor.id }}" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bookConsultationModalLabel{{ doctor.id }}">Book a Consultation with Dr. {{ doctor.name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="{{ url_for('web.submit_lead') }}" method="post">
                        <input type="hidden" name="doctor_id" value="{{ doctor.id }}">
                        <input type="hidden" name="source" value="Homepage">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        
                        <div class="row mb-3">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <label for="patient_name{{ doctor.id }}" class="form-label">Patient Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="patient_name{{ doctor.id }}" name="patient_name" required>
                            </div>
                            <div class="col-md-6">
                                <label for="mobile_number{{ doctor.id }}" class="form-label">Mobile Number (10 digits) <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="mobile_number{{ doctor.id }}" name="mobile_number" pattern="[0-9]{10}" required>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <label for="city{{ doctor.id }}" class="form-label">Select City <span class="text-danger">*</span></label>
                                <select class="form-select" id="city{{ doctor.id }}" name="city" required>
                                    <option value="" selected disabled>Select your city</option>
                                    <option value="Mumbai">Mumbai</option>
                                    <option value="Delhi">Delhi</option>
                                    <option value="Bangalore">Bangalore</option>
                                    <option value="Hyderabad">Hyderabad</option>
                                    <option value="Chennai">Chennai</option>
                                    <option value="Kolkata">Kolkata</option>
                                    <option value="Pune">Pune</option>
                                    <option value="Ahmedabad">Ahmedabad</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="preferred_date{{ doctor.id }}" class="form-label">Preferred Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="preferred_date{{ doctor.id }}" name="preferred_date" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="procedure_name{{ doctor.id }}" class="form-label">Select Procedure <span class="text-danger">*</span></label>
                            <select class="form-select" id="procedure_name{{ doctor.id }}" name="procedure_name" required>
                                <option value="" selected disabled>Select a procedure</option>
                                {% if all_procedures %}
                                    {% for procedure in all_procedures[:20] %}
                                        <option value="{{ procedure.procedure_name }}">{{ procedure.procedure_name }}</option>
                                    {% endfor %}
                                {% else %}
                                    <!-- High-demand procedures as options -->
                                    <option value="Rhinoplasty">Rhinoplasty</option>
                                    <option value="Breast Augmentation">Breast Augmentation</option>
                                    <option value="Liposuction">Liposuction</option>
                                    <option value="Facelift">Facelift</option>
                                    <option value="Hair Transplant">Hair Transplant</option>
                                    <option value="Dental Implants">Dental Implants</option>
                                    <option value="LASIK Eye Surgery">LASIK Eye Surgery</option>
                                {% endif %}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="message{{ doctor.id }}" class="form-label">Additional Information</label>
                            <textarea class="form-control" id="message{{ doctor.id }}" name="message" rows="3" placeholder="Any specific concerns or questions?"></textarea>
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="consent{{ doctor.id }}" name="consent" required>
                            <label class="form-check-label" for="consent{{ doctor.id }}">
                                I consent to data processing per Antidote's privacy policy as per DPDP Act 2023. <span class="text-danger">*</span>
                            </label>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-success">Submit Request</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
{% endif %}


{% endblock %}

{% block extra_js %}
<script>
// Personalization tracking for anonymous users
class PersonalizationTracker {
    constructor() {
        this.fingerprint = this.createFingerprint();
        this.sessionId = this.getOrCreateSessionId();
        this.init();
    }
    
    createFingerprint() {
        // Create browser fingerprint from available data
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        ctx.textBaseline = 'top';
        ctx.font = '14px Arial';
        ctx.fillText('Antidote fingerprint', 2, 2);
        const canvasHash = canvas.toDataURL().slice(-50);
        
        const fingerprint = btoa(JSON.stringify({
            userAgent: navigator.userAgent,
            language: navigator.language,
            platform: navigator.platform,
            screen: `${screen.width}x${screen.height}`,
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            canvas: canvasHash
        })).replace(/[^a-zA-Z0-9]/g, '').substring(0, 32);
        
        return fingerprint;
    }
    
    getOrCreateSessionId() {
        let sessionId = sessionStorage.getItem('antidote_session');
        if (!sessionId) {
            sessionId = 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem('antidote_session', sessionId);
        }
        return sessionId;
    }
    
    trackInteraction(type, contentType, contentId, contentName = '', pageUrl = window.location.pathname) {
        fetch('/personalization/track-interaction', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                fingerprint: this.fingerprint,
                interaction_type: type,
                content_type: contentType,
                content_id: contentId,
                content_name: contentName,
                page_url: pageUrl,
                session_id: this.sessionId
            })
        }).catch(error => {
            console.log('Personalization tracking error:', error);
        });
    }
    
    init() {
        // Track category clicks
        document.addEventListener('click', (e) => {
            const categoryCard = e.target.closest('[data-category-id]');
            if (categoryCard) {
                this.trackInteraction(
                    'click',
                    'category',
                    categoryCard.dataset.categoryId,
                    categoryCard.dataset.categoryName
                );
            }
            
            // Track procedure clicks
            const procedureLink = e.target.closest('[data-procedure-id]');
            if (procedureLink) {
                this.trackInteraction(
                    'click',
                    'procedure',
                    procedureLink.dataset.procedureId,
                    procedureLink.dataset.procedureName
                );
            }
            
            // Track doctor profile clicks
            const doctorLink = e.target.closest('[data-doctor-id]');
            if (doctorLink) {
                this.trackInteraction(
                    'click',
                    'doctor',
                    doctorLink.dataset.doctorId,
                    doctorLink.dataset.doctorName
                );
            }
        });
        
        // Track scroll depth for engagement
        let maxScroll = 0;
        window.addEventListener('scroll', () => {
            const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
            if (scrollPercent > maxScroll && scrollPercent % 25 === 0) {
                maxScroll = scrollPercent;
                this.trackInteraction('scroll', 'page', 0, `${scrollPercent}%`);
            }
        });
        
        // Track time spent on page
        const startTime = Date.now();
        window.addEventListener('beforeunload', () => {
            const timeSpent = Math.round((Date.now() - startTime) / 1000);
            if (timeSpent > 10) { // Only track if user spent more than 10 seconds
                this.trackInteraction('time_spent', 'page', 0, `${timeSpent}s`);
            }
        });
        
        // Track search queries from the search bar
        const searchInput = document.querySelector('#global-search');
        if (searchInput) {
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    if (e.target.value.length > 2) {
                        this.trackInteraction('search', 'query', 0, e.target.value);
                    }
                }, 1000);
            });
        }
    }
}

// Simple targeted certification removal - desktop only
function removeCertificationSection() {
    // Only run on desktop
    if (window.innerWidth >= 769) {
        const elementsToRemove = [];
        
        // Find text nodes with certification content
        const walker = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_TEXT,
            null,
            false
        );
        
        let textNode;
        while (textNode = walker.nextNode()) {
            const text = textNode.textContent.trim();
            if (text.includes('Trusted Expertise') && text.includes('Certified Professionals')) {
                let container = textNode.parentElement;
                // Go up to find the section container
                while (container && container !== document.body) {
                    const containerText = container.textContent.trim();
                    if (containerText.includes('Trusted Expertise') && 
                        containerText.includes('Certified Professionals') && 
                        containerText.length < 300) {
                        elementsToRemove.push(container);
                        break;
                    }
                    container = container.parentElement;
                }
            }
        }
        
        // Remove found elements
        elementsToRemove.forEach(element => {
            if (element && element.parentNode) {
                element.parentNode.removeChild(element);
            }
        });
    }
}

// Run once on page load
document.addEventListener('DOMContentLoaded', () => {
    removeCertificationSection();
});

// Typewriting Animation Class
class TypewriterEffect {
    constructor(element, texts, speed = 100, delay = 2000) {
        this.element = element;
        this.texts = texts;
        this.speed = speed;
        this.delay = delay;
        this.textIndex = 0;
        this.charIndex = 0;
        this.isTyping = false;
        this.originalPlaceholder = element.placeholder;
        this.start();
    }
    
    start() {
        if (this.texts.length > 0) {
            this.type();
        }
    }
    
    type() {
        if (this.charIndex < this.texts[this.textIndex].length) {
            this.element.placeholder = this.texts[this.textIndex].substring(0, this.charIndex + 1);
            this.charIndex++;
            setTimeout(() => this.type(), this.speed);
        } else {
            setTimeout(() => this.erase(), this.delay);
        }
    }
    
    erase() {
        if (this.charIndex > 0) {
            this.element.placeholder = this.texts[this.textIndex].substring(0, this.charIndex - 1);
            this.charIndex--;
            setTimeout(() => this.erase(), this.speed / 2);
        } else {
            this.textIndex = (this.textIndex + 1) % this.texts.length;
            setTimeout(() => this.type(), this.speed);
        }
    }
    
    stop() {
        this.element.placeholder = this.originalPlaceholder;
    }
}

// Initialize personalization tracking when page loads
document.addEventListener('DOMContentLoaded', () => {
    new PersonalizationTracker();
    
    // Initialize typewriting animations
    const packageSearchInput = document.getElementById('packageSearch');
    const aiConcernsDesktop = document.getElementById('aiConcernsDesktop');
    const aiConcernsMobile = document.getElementById('aiConcernsMobile');
    
    // Typewriting texts for treatments search
    const treatmentTexts = [
        "Hair transplant package in Mumbai",
        "Rhinoplasty treatment package",
        "Dental implant complete package",
        "Laser hair removal packages",
        "Skin whitening treatment bundle",
        "Breast augmentation package",
        "Liposuction complete package"
    ];
    
    // Typewriting texts for AI recommendations
    const aiConcernTexts = [
        "I have dark circles and want to look younger",
        "My nose is too wide, what are my options?",
        "I'm losing hair from the front of my head",
        "I have acne scars on my cheeks",
        "I want to reduce my double chin",
        "My skin looks dull and aged",
        "I have wrinkles around my eyes",
        "I want fuller lips without surgery"
    ];
    
    // Initialize typewriters
    let packageTypewriter, aiDesktopTypewriter, aiMobileTypewriter;
    
    if (packageSearchInput) {
        packageTypewriter = new TypewriterEffect(packageSearchInput, treatmentTexts, 80, 3000);
        
        // Stop typewriting when user focuses on input
        packageSearchInput.addEventListener('focus', () => {
            if (packageTypewriter) {
                packageTypewriter.stop();
            }
        });
    }
    
    if (aiConcernsDesktop) {
        aiDesktopTypewriter = new TypewriterEffect(aiConcernsDesktop, aiConcernTexts, 70, 3500);
        
        aiConcernsDesktop.addEventListener('focus', () => {
            if (aiDesktopTypewriter) {
                aiDesktopTypewriter.stop();
            }
        });
    }
    
    if (aiConcernsMobile) {
        aiMobileTypewriter = new TypewriterEffect(aiConcernsMobile, aiConcernTexts, 70, 3500);
        
        aiConcernsMobile.addEventListener('focus', () => {
            if (aiMobileTypewriter) {
                aiMobileTypewriter.stop();
            }
        });
    }
    

    

    
    // Enhanced tracking for new personalized sections
    document.addEventListener('click', (e) => {
        // Track package clicks
        const packageCard = e.target.closest('.package-card');
        if (packageCard) {
            const tracker = new PersonalizationTracker();
            tracker.trackInteraction('click', 'package', 0, 'featured_package_card');
        }
        
        // Track clinic clicks
        const clinicCard = e.target.closest('.clinic-card');
        if (clinicCard) {
            const tracker = new PersonalizationTracker();
            tracker.trackInteraction('click', 'clinic', 0, 'verified_clinic_card');
        }
        
        // Track AI recommendation clicks
        const aiRecommendation = e.target.closest('[data-ai-recommendation]');
        if (aiRecommendation) {
            const tracker = new PersonalizationTracker();
            tracker.trackInteraction('click', 'ai_recommendation', 0, aiRecommendation.dataset.aiRecommendation);
        }
    });
    

});
</script>

<style>
/* Personalized Homepage Styling */
.package-card {
    transition: all 0.3s ease;
    border-radius: 12px;
}

.package-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}

/* Duplicate packages-carousel styling removed - using the one from the main carousel section above */

/* Duplicate package-item definition removed - using the one from earlier in the file with mobile responsiveness */

/* Package title styling for all package sections */
.package-title,
.package-item .package-title,
.packages-carousel .package-title,
.featured-packages-section .package-title {
    color: #333;
    font-weight: bold;
    font-size: 16px;
    line-height: 1.3;
}

/* Desktop-specific package title styling - ensure override */
@media (min-width: 769px) {
    .package-title,
    .package-item .package-title,
    .packages-carousel .package-title,
    .featured-packages-section .package-title,
    .section-card .package-title,
    .card .package-title,
    h5.package-title,
    body h5.package-title,
    html h5.package-title {
        font-size: 16px !important;
        font-weight: bold !important;
        color: #333 !important;
    }
    
    /* Ultra-specific targeting for package titles */
    .package-item .flex-grow-1 h5.package-title,
    .packages-carousel .package-item .package-title,
    .featured-packages-section .package-item .package-title {
        font-size: 16px !important;
        font-weight: bold !important;
        color: #333 !important;
    }
}

/* Mobile-specific package title styling */
@media (max-width: 768px) {
    .package-title,
    .package-item .package-title,
    .packages-carousel .package-title,
    .featured-packages-section .package-title {
        font-size: 16px !important;
    }
}

/* Package card clinic name styling - override all other CSS files */
.package-item h6.text-primary,
.packages-carousel h6.text-primary,
.featured-packages-section h6.text-primary,
h6.text-primary {
    font-size: 13px !important;
}

/* Desktop-specific package card clinic name styling - ensure override */
@media (min-width: 769px) {
    .package-item h6.text-primary,
    .packages-carousel h6.text-primary,
    .featured-packages-section h6.text-primary,
    h6.text-primary,
    .section-card h6.text-primary,
    .card h6.text-primary,
    body h6.text-primary,
    html h6.text-primary {
        font-size: 13px !important;
        font-weight: normal !important;
    }
    
    /* Ultra-specific targeting for package cards */
    .package-item .flex-grow-1 h6.text-primary,
    .packages-carousel .package-item h6.text-primary,
    .featured-packages-section .package-item h6.text-primary {
        font-size: 13px !important;
        font-weight: normal !important;
        color: #00A0B0 !important;
    }
}

/* Mobile-specific package card clinic name styling */
@media (max-width: 768px) {
    .package-item h6.text-primary,
    .packages-carousel h6.text-primary,
    .featured-packages-section h6.text-primary,
    h6.text-primary {
        font-size: 13px !important;
    }
}

.package-description {
    line-height: 1.4;
    font-size: 0.9rem;
}

/* Clinic Card Styling */
.clinic-card {
    transition: all 0.3s ease;
    border-radius: 12px;
    border: 1px solid #dee2e6;
}

.clinic-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.12);
    border-color: #4A90E2;
}

.clinic-card .card-title {
    color: #333;
    font-weight: 600;
    font-size: 1.1rem;
}

/* Clinic Carousel Styling */
.clinics-carousel {
    overflow-x: auto;
    display: flex;
    gap: 20px;
    padding: 15px 0;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

.clinics-carousel::-webkit-scrollbar {
    height: 6px;
}

.clinics-carousel::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.clinics-carousel::-webkit-scrollbar-thumb {
    background: #4A90E2;
    border-radius: 10px;
}

.clinics-carousel::-webkit-scrollbar-thumb:hover {
    background: #357ABD;
}

/* Clinic Slider Item Styling */
.clinic-slider-item {
    min-width: 300px;
    max-width: 300px;
    min-height: 280px;
    border: 1px solid #dee2e6;
    border-radius: 12px;
    padding: 20px;
    background: white;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
}

.clinic-slider-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 25px rgba(0,0,0,0.12);
    border-color: #4A90E2;
}

.clinic-slider-item .clinic-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
}

.clinic-slider-item .clinic-description {
    font-size: 0.9rem;
    line-height: 1.4;
    color: #6c757d;
}

.clinic-slider-item .clinic-stats-row {
    font-size: 0.85rem;
}

.clinic-slider-item {
    min-width: 320px;
    max-width: 320px;
    min-height: 180px;
    border: 1px solid #dee2e6;
    border-radius: 12px;
    padding: 20px;
    background: white;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.clinic-slider-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.12);
    border-color: #4A90E2;
}

.clinic-title {
    color: #333;
    font-weight: bold;
    font-size: 1.1rem;
    line-height: 1.3;
}

.clinic-description {
    line-height: 1.4;
    font-size: 0.9rem;
}

.clinic-card {
    transition: all 0.3s ease;
    border-radius: 12px;
}

.clinic-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}

.activity-ticker {
    overflow: hidden;
    white-space: nowrap;
}

.activity-item {
    display: inline-block;
    animation: tickerScroll 20s linear infinite;
    font-size: 0.9rem;
    color: #6c757d;
}

@keyframes tickerScroll {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
}

.ai-search-container .form-control:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.ai-results-content {
    max-height: 400px;
    overflow-y: auto;
}

.stat-item {
    padding: 0.5rem;
}

.text-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Enhanced responsive design for new sections */
@media (max-width: 768px) {
    .clinic-stats .row {
        text-align: center;
    }
    
    .activity-ticker {
        font-size: 0.8rem;
    }
    
    .package-card .card-body,
    .clinic-card .card-body {
        padding: 1rem;
    }
    
    /* Mobile responsive category cards - fit 2.5 cards per row */
    .category-slider-item {
        min-width: 135px !important;
        max-width: 135px !important;
        min-height: 160px !important;
        padding: 12px !important;
    }
    
    .category-slider-item .category-icon-wrapper {
        width: 60px !important;
        height: 60px !important;
        margin-bottom: 0.6rem !important;
    }
    
    .category-slider-item .category-title {
        font-size: 0.85rem !important;
        margin-bottom: 0.4rem !important;
        line-height: 1.3 !important;
    }
    
    .category-slider-item .procedure-count {
        margin-bottom: 0 !important;
    }
    
    .category-slider-item .procedure-count small {
        font-size: 0.7rem !important;
    }
    
    .categories-carousel {
        gap: 12px !important;
        padding-left: 12px !important;
        padding-right: 12px !important;
    }
    
    /* Adjust category images for 2.5-card mobile layout */
    .category-slider-item .category-image {
        width: 60px !important;
        height: 53px !important;
        border-radius: 10px !important;
    }
    
    .category-slider-item .category-icon {
        font-size: 1.5rem !important;
    }
}

/* Categories Carousel Styling - Matching Clinic Carousel Design Language */
.categories-carousel {
    overflow-x: auto;
    display: flex;
    gap: 15px;
    padding: 10px 0;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

.categories-carousel::-webkit-scrollbar {
    height: 6px;
}

.categories-carousel::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.categories-carousel::-webkit-scrollbar-thumb {
    background: #4A90E2;
    border-radius: 10px;
}

.categories-carousel::-webkit-scrollbar-thumb:hover {
    background: #357ABD;
}

.category-slider-item {
    min-width: 220px;
    max-width: 220px;
    min-height: 260px;
    border: 1px solid #dee2e6;
    border-radius: 12px;
    padding: 16px;
    background: white;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    text-align: center;
}

.category-slider-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.12);
    border-color: #4A90E2;
}

.category-slider-item .category-icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 0.8rem;
    width: 90px;
    height: 90px;
    border-radius: 12px;
    position: relative;
    z-index: 1;
    background: linear-gradient(135deg, rgba(142, 216, 210, 0.2) 0%, rgba(91, 171, 163, 0.15) 100%);
    box-shadow: 0 4px 12px -4px rgba(91, 171, 163, 0.25);
    overflow: hidden;
}

.category-slider-item .category-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 12px;
    transform: scale(1.3);
}

.category-slider-item .category-title {
    color: #333;
    font-weight: bold;
    font-size: 1rem;
    line-height: 1.2;
}

.category-slider-item .category-description {
    line-height: 1.3;
    font-size: 0.85rem;
    flex-grow: 1;
}

.category-slider-item .category-btn-wrapper {
    margin-top: auto;
}

.category-slider-item .category-btn {
    transition: all 0.3s ease;
    pointer-events: none;
}

.category-slider-item:hover .category-btn {
    background-color: #4A90E2;
    color: white;
    border-color: #4A90E2;
}

/* Popular Procedures Carousel Styling - Fixed Design Flaws */
.procedure-slider-item {
    min-width: 320px;
    max-width: 320px;
    min-height: 280px;
    border: 1px solid #e9ecef;
    border-radius: 16px;
    padding: 24px;
    background: white;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
}

.procedure-slider-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    border-color: #4A90E2;
}

.procedure-slider-item .procedure-header {
    margin-bottom: 1rem;
}

.procedure-slider-item .procedure-badges {
    flex-wrap: wrap;
    align-items: flex-start;
}

.procedure-slider-item .procedure-badges .badge {
    font-size: 0.75rem;
    font-weight: 600;
}

.procedure-slider-item .procedure-title {
    color: #2c3e50;
    font-size: 1.25rem;
    line-height: 1.3;
    margin-bottom: 0.75rem;
}

.procedure-slider-item .procedure-description {
    font-size: 0.95rem;
    line-height: 1.5;
    color: #6c757d;
    margin-bottom: 1rem;
    flex-grow: 1;
}

.procedure-slider-item .procedure-details {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 16px;
    margin-top: auto;
}

.procedure-slider-item .detail-item {
    margin-bottom: 8px;
}

.procedure-slider-item .detail-item:last-child {
    margin-bottom: 0;
}

.procedure-slider-item .detail-item i {
    width: 16px;
    text-align: center;
    font-size: 0.9rem;
}

.procedure-slider-item .detail-text {
    font-size: 0.9rem;
    font-weight: 500;
    color: #495057;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle AI Recommendation Form
    const aiForm = document.getElementById('aiRecommendationForm');
    const desktopTextarea = document.getElementById('aiConcernsDesktop');
    const mobileTextarea = document.getElementById('aiConcernsMobile');
    const hiddenInput = document.getElementById('hiddenConcerns');
    
    if (aiForm && hiddenInput) {
        // Sync textareas
        function syncTextareas() {
            const activeTextarea = window.innerWidth >= 992 ? desktopTextarea : mobileTextarea;
            if (activeTextarea && activeTextarea.value.trim()) {
                hiddenInput.value = activeTextarea.value.trim();
                // Sync the other textarea too
                if (activeTextarea === desktopTextarea && mobileTextarea) {
                    mobileTextarea.value = activeTextarea.value;
                } else if (activeTextarea === mobileTextarea && desktopTextarea) {
                    desktopTextarea.value = activeTextarea.value;
                }
            }
        }
        
        // Add event listeners to both textareas
        if (desktopTextarea) {
            desktopTextarea.addEventListener('input', syncTextareas);
        }
        if (mobileTextarea) {
            mobileTextarea.addEventListener('input', syncTextareas);
        }
        
        // Handle form submission
        aiForm.addEventListener('submit', function(e) {
            syncTextareas();
            
            if (!hiddenInput.value.trim()) {
                e.preventDefault();
                alert('Please describe your concerns to get AI recommendations.');
                return false;
            }
            
            console.log('AI form submitting with concerns:', hiddenInput.value);
        });
    }
});

// Instant Banner System for optimized loading and mobile responsiveness
if (document.getElementById('hero-banner')) {
    const heroContainer = document.getElementById('hero-banner');
    
    // Handle server-side rendered banners for instant loading
    {% if hero_banner_data and hero_banner_data.slides %}
    const bannerData = {{ hero_banner_data|tojson|safe }};
    const slide = bannerData.slides[0];
    
    // Apply responsive image switching
    function updateBannerImage() {
        const slideContent = document.querySelector('#hero-banner .slide-content');
        if (slideContent && slide.mobile_image_url) {
            const isMobile = window.innerWidth <= 768;
            const imageUrl = isMobile ? slide.mobile_image_url : slide.image_url;
            slideContent.style.backgroundImage = `url('${imageUrl}')`;
        }
    }
    
    // Initial image setup
    updateBannerImage();
    
    // Handle window resize for responsive images
    window.addEventListener('resize', updateBannerImage);
    
    // Track banner impression without CSRF (analytics endpoint) - only if slide exists
    if (slide && slide.id) {
        fetch('/api/banners/impression', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                slide_id: slide.id,
                position: 'hero_banner'
            })
        }).catch(err => console.warn('Banner impression tracking failed:', err.status || 'Network error'));
    }
    
    // Track banner clicks
    const bannerLink = document.querySelector('#hero-banner .banner-link');
    if (bannerLink) {
        bannerLink.addEventListener('click', function(e) {
            // Track click event - only if slide exists
            if (slide && slide.id) {
                fetch('/api/banners/click', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        slide_id: slide.id,
                        position: 'hero_banner'
                    })
                }).catch(err => console.warn('Banner click tracking failed:', err));
            }
        });
    }
    {% else %}
    // Fallback: Load via JavaScript if server-side data unavailable
    const smartBannerScript = document.createElement('script');
    smartBannerScript.src = '{{ url_for("static", filename="js/smart-banner-loader.js") }}';
    document.head.appendChild(smartBannerScript);
    {% endif %}
}
</script>
{% endblock %}
